<!DOCTYPE html>
<html ⚡="" amp="">
  <head><meta charset="utf-8"><script async src="https://cdn.ampproject.org/v0.js"></script>
    
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="theme-color" content="#263238">

<meta name="generator" content="Hugo 0.91.2">

<link rel="apple-touch-icon" href="https://blog.mgechev.com/images/logo.png">


<link rel="canonical" href="https://blog.mgechev.com/2012/11/24/javascript-sorting-performance-quicksort-v8/">


    
    <style amp-custom=""></style>
    
    <title>Looking for performance? Probably you should NOT use [].sort (V8) - Minko Gechev&apos;s blog</title>
    <style amp-boilerplate="">body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate="">body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    
    
<meta name="description" content="A few days ago, I&#x2019;ve created a GitHub repository. It&#x2019;s main goal was to collect different algorithms with implementations in JavaScript. I started with basic ones &#x2013; sorting (insertion, selection, bubble sort..). After that I implemented few &#x201C;more advance&#x201D; like marge, quick and heap sort. It was interesting to me how much slower my implementation will be compared to the default sort. It was so interesting because of:function sort() { [native code] } That&#x2019;s why I&#x2019;ve wrote not optimized version of mergesort and I&#x2019;ve run it with generated array with 500k elements.">

<meta property="og:title" content="Looking for performance? Probably you should NOT use [].sort (V8) - Minko Gechev&apos;s blog">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.mgechev.com/2012/11/24/javascript-sorting-performance-quicksort-v8/">
<meta property="og:site_name" content="Minko Gechev&apos;s blog">
<meta property="og:description" content="A few days ago, I&#x2019;ve created a GitHub repository. It&#x2019;s main goal was to collect different algorithms with implementations in JavaScript. I started with basic ones &#x2013; sorting (insertion, selection, bubble sort..). After that I implemented few &#x201C;more advance&#x201D; like marge, quick and heap sort. It was interesting to me how much slower my implementation will be compared to the default sort. It was so interesting because of:function sort() { [native code] } That&#x2019;s why I&#x2019;ve wrote not optimized version of mergesort and I&#x2019;ve run it with generated array with 500k elements.">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="Minko Gechev&apos;s blog">
<meta name="twitter:url" content="https://blog.mgechev.com/2012/11/24/javascript-sorting-performance-quicksort-v8/">
<meta name="twitter:title" content="Looking for performance? Probably you should NOT use [].sort (V8) - Minko Gechev&apos;s blog">
<meta name="twitter:description" content="A few days ago, I&#x2019;ve created a GitHub repository. It&#x2019;s main goal was to collect different algorithms with implementations in JavaScript. I started with basic ones &#x2013; sorting (insertion, selection, bubble sort..). After that I implemented few &#x201C;more advance&#x201D; like marge, quick and heap sort. It was interesting to me how much slower my implementation will be compared to the default sort. It was so interesting because of:function sort() { [native code] } That&#x2019;s why I&#x2019;ve wrote not optimized version of mergesort and I&#x2019;ve run it with generated array with 500k elements.">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"https:\/\/blog.mgechev.com\/"
    },
    "headline": "Looking for performance? Probably you should NOT use [].sort (V8) - Minko Gechev\u0027s blog",
    "datePublished": "2012-11-24T00:00:00JST",
    "dateModified": "2012-11-24T00:00:00JST",
    "author": {
      "@type": "Person",
      "name": "Minko Gechev\u0027s blog"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Minko Gechev\u0027s blog",
      "logo": {
        "@type": "ImageObject",
        "url": "https:\/\/blog.mgechev.com\/images/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "A few days ago, I’ve created a GitHub repository. It’s main goal was to collect different algorithms with implementations in JavaScript. I started with basic ones – sorting (insertion, selection, bubble sort..). After that I implemented few “more advance” like marge, quick and heap sort. It was interesting to me how much slower my implementation will be compared to the default sort. It was so interesting because of:\nfunction sort() { [native code] } That’s why I’ve wrote not optimized version of mergesort and I’ve run it with generated array with 500k elements."
  }
</script>


    <style amp-custom="">
      html { font-size: 18px;}@media (max-width: 768px) { html { font-size: 15px; }}body { font-family: Lato,'Hiragino Kaku Gothic Pro',メイリオ,Meiryo,sans-serif; font-size: inherit; margin: 0; color: #263238;}html, body { margin: 0;}a { text-decoration: none; color: #e91e63;}p { margin: 0;}ul,ol { margin: 0; padding: 0;}h1, h2, h3, h4, h5, h6 { margin: 0; font-weight: 700;}h1 { font-size: 1.8rem; line-height: 2rem; margin: 1.5rem 0; }h2 { font-size: 1.4rem; line-height: 2rem; margin: 1.5rem 0; }h3 { font-size: 1.2rem; line-height: 1.5rem; margin: 1.5rem 0; }h4, h5, h6 { font-size: 1rem; line-height: 1.5rem; margin: 1.5rem 0; }.clearfix::after { content: ''; display: block; clear: both;}main { display: block;}/* Layouts */.l-header { padding: .5rem 0; margin-bottom: 2rem; border-bottom: 1px dashed #cfd8dc; text-align: center;}.l-footer { font-size: .8rem; padding: 1rem 0; border-top: 1px dashed #cfd8dc;}.l-container { max-width: 42rem; margin: 0 auto; padding: 0 1rem;}/* Parts:logo */.p-logo { font-family: Lobster, cursive;}.p-logo a { color: #000; font-size: 1.6rem; line-height: 2rem;}/* Parts:section */section { border-top: 2px solid #eceff1; padding: 1.5rem 0;}section>header { text-transform: uppercase; font-weight: 700; margin-bottom: 2rem; text-align: center;}section>header span { display: inline-block; background-color: #000; color: #fff; letter-spacing: 3px; font-size: .7rem; padding: .5rem .75rem;}/* Parts:facts */.p-facts { list-style: none; font-size: .8rem; margin-bottom: 1rem;}.p-facts:last-child { margin-bottom: 0;}.p-facts li { display: inline-block; margin-right: .5rem; text-transform: uppercase;}.p-facts li header { margin-bottom: .25rem; font-weight: 700;}.p-facts li header a { color: #000; text-decoration: underline;}.p-facts li li { display: inline-block; margin-right: .5rem;}.p-facts li li::after { content: ',';}.p-facts li li:last-child::after { content: '';}/* Parts:crumb */.p-crumb { list-style: none; margin-bottom: 1rem; font-size: .8rem; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}.p-crumb:last-child { margin-bottom: 0;}.p-crumb li { display: inline;}.p-crumb li::after { content: '›'; margin: 0 .5rem;}.p-crumb li:last-child::after { content: '';}/* Parts:page-title */.p-page-title { margin-bottom: 2rem;}.p-page-title .title { margin-bottom: .5rem;}/* Parts:share */.p-share { margin-bottom: 1.5rem;}.p-share a { display: inline-block; text-align: center; padding: .5rem .5rem; margin-right: .25rem; font-size: .6rem; background-color: #eceff1; font-weight: 700k}.p-share a.ht { color: #00a4de; }.p-share a.fb { color: #3b5998; }.p-share a.tw { color: #1da1f2; }.p-share a.gp { color: #dd4b39; }.p-share a.ln { color: #00c300; }.p-share a.ht::before { content: 'Hatena'; }.p-share a.fb::before { content: 'Facebook'; }.p-share a.tw::before { content: 'Twitter'; }.p-share a.gp::before { content: 'Google+'; }.p-share a.ln::before { content: 'LINE'; }/* Parts:terms */.p-terms { padding-left: 2rem;}/* Parts:paginator */.p-paginator { text-align: center; margin-bottom: 3rem; padding-top: 2rem;}.p-paginator a { display: inline-block; border: 2px solid #eceff1; color: #263238; line-height: 2rem; padding: 0 1rem;}/* Parts:article */.p-articles { list-style: none;}.p-articles>li { margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px dashed #cfd8dc;}.p-articles>li:last-child { border-bottom: none; padding-bottom: 0;}.p-articles.thin>li { margin-bottom: 1rem; padding-bottom: 1rem;}article .article-header { display: table-cell; height: 6rem; vertical-align: middle;}article .title { margin: 0; margin-bottom: .5rem; font-size: 1.4rem; line-height: 2rem;}article .title a { color: #000;}article .header-wrapper { margin-bottom: 1.5rem;}article .thumbnail { display: none;}article .summary { margin-bottom: 1.5rem;}article .readmore { text-align: center;}article .readmore a { font-size: .8rem; color: #000; text-decoration: underline;}article.li.sm .header-wrapper { margin-bottom: 0;}.article-body h2 { padding: 1rem 0; border-bottom: 2px solid #eceff1;}.article-body h2:first-child { margin-top: 0; }.article-body h3 { color: #cddc39;}.article-body h4 { border-left: solid .25rem #cddc39; padding: 0 .5rem;}.article-body p { margin: 1.5rem 0; line-height: 1.5rem;}.article-body a { text-decoration: underline;}.article-body ul,.article-body ol { padding-left: 1.5rem;}.article-body code { display: inline-block; font-family: Menlo, consolas, monospace; background-color: #eceff1; font-size: .8rem; padding: 0 .5rem; line-height: 1.5rem;}.article-body pre { margin: 1.5rem 0; padding: 1.5rem; font-size: .8rem; background-color: #263238; color: #fff; overflow: auto;}.article-body pre code { background-color: transparent;}.article-body blockquote { margin: 1.5rem 0; padding: .5rem 0; font-size: .8rem; border-top: 1px solid #eceff1; border-bottom: 1px solid #eceff1; color: #607d8b;}.article-body blockquote p { margin: .5rem 0; line-height: 1rem;}.article-body strong { box-shadow: 0 -.5rem 0 0 #f06292 inset;}.article-body em { font-style: normal; font-weight: 700; color: #ff5722;}.article-body figure { margin: 1.5rem -2rem; }.article-body figure.left,.article-body figure.right { width: 15rem; height: 12rem; margin-top: 0; margin-left: 0; margin-right: 0;}.article-body figure.left { float: left; margin-right: 1rem; margin-left: -2rem; }.article-body figure.right { float: right; margin-left: 1rem; margin-right: -2rem; }@media (max-width: 768px) { .article-body figure { margin: 1.5rem -1rem; } .article-body figure.left, .article-body figure.right { float: none; margin: 0 -1rem; width: auto; height: auto; }}.article-body figcaption { padding: .5rem 0; font-size: .8rem; text-align: center;}.article-body figcaption a { color: #263238;}img { max-width: 100%;}

      
    </style>
  </head>

  <body>
    
    
    <amp-analytics type="googleanalytics" id="analytics1">
      <script type="application/json">
        {
          "vars": {
            "account": "UA-18060688-3"
          },
          "triggers": {
            "trackPageview": {
              "on": "visible",
              "request": "pageview"
            }
          }
        }
      </script>
    </amp-analytics>
    
    

    <header class="l-header">
      <div class="l-container">
        <div class="h-logo p-logo">
          <a href="https://blog.mgechev.com/" class="h-logo">Minko Gechev&apos;s blog</a>
        </div>
      </div>
    </header>

    <main>
      
<div class="l-container">
  <article class="single article-69bd33df806ecb788c11711f8681688d">
  <div class="header-wrapper">
    <a href="https://blog.mgechev.com/2012/11/24/javascript-sorting-performance-quicksort-v8/" class="thumbnail" title="Looking for performance? Probably you should NOT use [].sort (V8)"></a>
    <header class="article-header">
      <div class="clearfix">
        <h1 class="title">Looking for performance? Probably you should NOT use [].sort (V8)</h1>
        <ul class="p-facts">
          <li><time datetime="2012-11-24T00:00:00JST">Nov 24, 2012</time></li>
          <li><a href="https://blog.mgechev.com/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>

  <aside class="p-share">
  <a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.mgechev.com%2f2012%2f11%2f24%2fjavascript-sorting-performance-quicksort-v8%2f&amp;t=Looking%20for%20performance%3f%20Probably%20you%20should%20NOT%20use%20%5b%5d.sort%20%28V8%29" title="Facebook&#x3067;&#x30B7;&#x30A7;&#x30A2;" class="fb" target="_blank" rel="nofollow"></a>
  <a href="http://twitter.com/intent/tweet?url=https%3a%2f%2fblog.mgechev.com%2f2012%2f11%2f24%2fjavascript-sorting-performance-quicksort-v8%2f&amp;text=Looking%20for%20performance%3f%20Probably%20you%20should%20NOT%20use%20%5b%5d.sort%20%28V8%29&amp;tw_p=tweetbutton" title="Twitter&#x3067;&#x30B7;&#x30A7;&#x30A2;" class="tw" target="_blank" rel="nofollow"></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fblog.mgechev.com%2f2012%2f11%2f24%2fjavascript-sorting-performance-quicksort-v8%2f" title="Google Plus&#x3067;&#x30B7;&#x30A7;&#x30A2;" class="gp" target="_blank" rel="nofollow"></a>
</aside>


  <div class="article-body"><p>A few days ago, I&#x2019;ve created a <a title="Algorithms implemented in JavaScript" href="https://github.com/mgechev/javascript-algorithms" target="_blank">GitHub repository</a>. It&#x2019;s main goal was to collect different algorithms with implementations in JavaScript. I started with basic ones &#x2013; sorting (insertion, selection, bubble sort..). After that I implemented few &#x201C;more advance&#x201D; like marge, quick and heap sort. It was interesting to me how much slower my implementation will be compared to the default sort. It was so interesting because of:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">sort</span><span class="p">()</span> <span class="p">{</span> <span class="p">[</span><span class="kr">native</span> <span class="nx">code</span><span class="p">]</span> <span class="p">}</span></code></pre></div>
<p>That&#x2019;s why I&#x2019;ve wrote not optimized version of mergesort and I&#x2019;ve run it with generated array with 500k elements. I waited&#x2026;waited&#x2026;and at last, after about 15 minutes the array was sorted. It was quite disappointing. I decided that it was so slow because of the recursion inside it. I have had bad experience with DFS using recursion for manipulating the DOM tree. The result for the default sort was about 0.5 seconds. For that test I&#x2019;ve used nodejs (<a href="https://en.wikipedia.org/wiki/Nodejs" target="_blank">it uses Google&#x2019;s V8 engine</a>). After merge sort I&#x2019;ve implemented heap sort. Also not bad algorithm with complexity O(nlog(n)). I though that it will be faster in Node.js because in my opinion that the recursion was the thing that made the mergesort so slow. I&#x2019;ve generated another array with 500k elements using a simple perl script. The result was very interesting&#x2026;In the chart below you can see mergesort compared to heapsort for array with 50k elements.</p>
<div id="attachment_237" style="width: 683px" class="wp-caption alignnone">
  <a href="/images/legacy/uploads2012/11/50k-heap-vs-merge.png"><amp-img class="size-full wp-image-237 " title="Heapsort vs Mergesort 50k" src="/images/legacy/uploads2012/11/50k-heap-vs-merge.png" alt="" width="673" height="385"></amp-img></a><p class="wp-caption-text">
    Heapsort vs Mergesort 50k elements
  </p>
</div>
<p>In the X-axis it&#x2019;s an attempt number, the Y-axis is the time required for the algorithm to finish (in seconds).</p>
<p>Here is the implementation of the Mergesort:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="cm">/* Mergesort */</span>
<span class="kd">var</span> <span class="nx">mergeSort</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">merger</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">[];</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">middle</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">((</span><span class="nx">start</span> <span class="o">+</span> <span class="nx">end</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

        <span class="nx">merger</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">middle</span><span class="p">);</span>
        <span class="nx">merger</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">middle</span><span class="p">,</span> <span class="nx">end</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">middle</span><span class="p">,</span> <span class="nx">end</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">middle</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">right</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">leftSize</span> <span class="o">=</span> <span class="nx">middle</span> <span class="o">-</span> <span class="nx">start</span><span class="p">,</span>
            <span class="nx">rightSize</span> <span class="o">=</span> <span class="nx">end</span> <span class="o">-</span> <span class="nx">middle</span><span class="p">,</span>
            <span class="nx">maxSize</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">leftSize</span><span class="p">,</span> <span class="nx">rightSize</span><span class="p">),</span>
            <span class="nx">size</span> <span class="o">=</span> <span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">,</span>
            <span class="nx">i</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">maxSize</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">leftSize</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">left</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="nx">start</span> <span class="o">+</span> <span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">rightSize</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">right</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="nx">middle</span> <span class="o">+</span> <span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">size</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">left</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">right</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">right</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">array</span><span class="p">[</span><span class="nx">start</span> <span class="o">+</span> <span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">right</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">array</span><span class="p">[</span><span class="nx">start</span> <span class="o">+</span> <span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">left</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">left</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">array</span><span class="p">[</span><span class="nx">start</span> <span class="o">+</span> <span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">left</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">array</span><span class="p">[</span><span class="nx">start</span> <span class="o">+</span> <span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">right</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">merger</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}());</span></code></pre></div>
<p>And the heapsort:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="cm">/* Heapsort */</span>
<span class="kd">var</span> <span class="nx">heapSort</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">heapify</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">heapSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">right</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nx">largest</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">left</span> <span class="o">&lt;</span> <span class="nx">heapSize</span> <span class="o">&amp;&amp;</span> <span class="nx">array</span><span class="p">[</span><span class="nx">left</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">array</span><span class="p">[</span><span class="nx">index</span><span class="p">])</span>
            <span class="nx">largest</span> <span class="o">=</span> <span class="nx">left</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">right</span> <span class="o">&lt;</span> <span class="nx">heapSize</span> <span class="o">&amp;&amp;</span> <span class="nx">array</span><span class="p">[</span><span class="nx">right</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">array</span><span class="p">[</span><span class="nx">largest</span><span class="p">])</span>
            <span class="nx">largest</span> <span class="o">=</span> <span class="nx">right</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">largest</span> <span class="o">!==</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">temp</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
            <span class="nx">array</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="nx">largest</span><span class="p">];</span>
            <span class="nx">array</span><span class="p">[</span><span class="nx">largest</span><span class="p">]</span> <span class="o">=</span> <span class="nx">temp</span><span class="p">;</span>
            <span class="nx">heapify</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">largest</span><span class="p">,</span> <span class="nx">heapSize</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">buildMaxHeap</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">array</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">heapify</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
            <span class="nx">temp</span><span class="p">;</span>
        <span class="nx">buildMaxHeap</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">temp</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="nx">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">temp</span><span class="p">;</span>
            <span class="nx">size</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="nx">heapify</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">size</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}());</span></code></pre></div>
<p>If you find any mistakes in any of the implementations I&#x2019;ll be glad to know and fix them. In the script above I use simple closure to hide the methods which are not useful for the public API.
After I&#x2019;ve made the test between merge and heap sorts I noticed that there&#x2019;s a quite big difference&#x2026;So that&#x2019;s why I started heap vs the default sort to see how faster the native sort will be:</p>
<div id="attachment_239" style="width: 683px" class="wp-caption alignnone">
  <a href="/images/legacy/uploads2012/11/500k-heap-vs-default.png"><amp-img class="size-full wp-image-239" title="Heapsort vs the default sort 500k elements" src="/images/legacy/uploads2012/11/500k-heap-vs-default.png" alt="" width="673" height="385"></amp-img></a><p class="wp-caption-text">
    Heapsort vs the default sort 500k elements
  </p>
</div>
<p>As you see the result is quite unexpected&#x2026;I&#x2019;ve checked my algorithm many times because I thought that it isn&#x2019;t correct&#x2026;In more than half of the cases (because as you might see there are 50 tests) heapsort is faster than the default sort. The default sort is some kind of optimized quicksort mixed with insertion sort for small arrays.&#xA0;The exact implementation of the V8 sort can be found <a href="https://github.com/v8/v8" target="_blank">somewhere here</a>.</p>
<p>That is the perl script which I used for the test:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Time::HiRes</span> <span class="sx">qw/time/</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">%sorts</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">my</span> <span class="nv">%algorithm_source</span> <span class="o">=</span> <span class="p">();</span>

<span class="c1">#Generates JavaScript array with defined size and maximum size of it&apos;s elements</span>
<span class="k">sub</span> <span class="nf">generate_js_array</span><span class="p">($ $) {</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$size</span><span class="p">,</span> <span class="nv">$max</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$array</span> <span class="o">=</span> <span class="s">&apos;var array = [&apos;</span><span class="p">;</span>
    <span class="nb">map</span> <span class="p">{</span> <span class="nv">$array</span> <span class="o">.=</span> <span class="nb">rand</span><span class="p">(</span><span class="nv">$max</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;,\n&quot;</span> <span class="p">}</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="nv">$size</span><span class="p">);</span>
    <span class="nb">chop</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
    <span class="nb">chop</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
    <span class="nv">$array</span> <span class="o">.=</span> <span class="s">&apos;];&apos;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$array</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">#Creates a new test for given sort type and array</span>
<span class="k">sub</span> <span class="nf">create_test</span><span class="p">($ $) {</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$sort_type</span><span class="p">,</span> <span class="nv">$array</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$sort_algorithm</span> <span class="o">=</span> <span class="nv">$algorithm_source</span><span class="p">{</span><span class="nv">$sort_type</span><span class="p">};</span>
    <span class="k">my</span> <span class="nv">$test_case</span> <span class="o">=</span> <span class="s">&quot;$array\n$sort_algorithm&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$test_case</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">#Saves the test in a file into the temp directory</span>
<span class="k">sub</span> <span class="nf">save_test_case</span><span class="p">($ $ $) {</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$test_case</span><span class="p">,</span> <span class="nv">$sort_type</span><span class="p">,</span> <span class="nv">$i</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="s">&quot;./temp/$sort_type-$i.js&quot;</span><span class="p">;</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">FH</span><span class="p">,</span> <span class="s">&quot;&gt;$filename&quot;</span><span class="p">);</span>
    <span class="k">print</span> <span class="n">FH</span> <span class="nv">$test_case</span><span class="p">;</span>
    <span class="nb">close</span><span class="p">(</span><span class="n">FH</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$filename</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">#Runs the test and measures the runtime</span>
<span class="k">sub</span> <span class="nf">run_test_case</span><span class="p">($)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$time</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
    <span class="sb">`d8 $filename`</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="nv">$time</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">#Tests an algorithm with given array</span>
<span class="k">sub</span> <span class="nf">test_algorithm</span><span class="p">($ $ $) {</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$sort_type</span><span class="p">,</span> <span class="nv">$array</span><span class="p">,</span> <span class="nv">$test_count</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$test_case</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$performance</span><span class="p">);</span>
    <span class="nv">$test_case</span> <span class="o">=</span> <span class="n">create_test</span><span class="p">(</span><span class="nv">$sort_type</span><span class="p">,</span> <span class="nv">$array</span><span class="p">);</span>
    <span class="nv">$filename</span> <span class="o">=</span> <span class="n">save_test_case</span><span class="p">(</span><span class="nv">$test_case</span><span class="p">,</span> <span class="nv">$sort_type</span><span class="p">,</span> <span class="nv">$test_count</span><span class="p">);</span>
    <span class="k">print</span> <span class="s">&quot;Running the test case...\n&quot;</span><span class="p">;</span>
    <span class="nv">$performance</span> <span class="o">=</span> <span class="n">run_test_case</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
    <span class="c1">#unlink($filename);</span>
    <span class="k">print</span> <span class="s">&quot;Cleaning the trash...\n&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$performance</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">#Gets the source of an algorithm from the algorithms folder</span>
<span class="k">sub</span> <span class="nf">get_algorithm</span><span class="p">($)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$sort_type</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$sorts</span><span class="p">{</span><span class="nv">$sort_type</span><span class="p">};</span>
    <span class="k">my</span> <span class="nv">$result</span> <span class="o">=</span> <span class="s">&apos;&apos;</span><span class="p">;</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">FH</span><span class="p">,</span> <span class="s">&quot;&lt;./algorithms/$file&quot;</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="sr">&lt;FH&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">.=</span> <span class="nv">$_</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nb">close</span><span class="p">(</span><span class="n">FH</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">#Caches all algorithms into a hash with keys the algorithm name and value the algorithm</span>
<span class="k">sub</span> <span class="nf">cache_algorithms_source</span> <span class="p">{</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$algorithm</span> <span class="p">(</span><span class="nb">keys</span><span class="p">(</span><span class="nv">%sorts</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$algorithm_source</span><span class="p">{</span><span class="nv">$algorithm</span><span class="p">}</span> <span class="o">=</span> <span class="n">get_algorithm</span><span class="p">(</span><span class="nv">$algorithm</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">#Tests all algorithms with different arrays and tests count</span>
<span class="k">sub</span> <span class="nf">test_algorithms</span><span class="p">($ $ $) {</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$tests_count</span><span class="p">,</span> <span class="nv">$size</span><span class="p">,</span> <span class="nv">$max</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">%result</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nv">$count</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$tests_count</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$array</span> <span class="o">=</span> <span class="n">generate_js_array</span><span class="p">(</span><span class="nv">$size</span><span class="p">,</span> <span class="nv">$max</span><span class="p">);</span>
        <span class="nv">$count</span> <span class="o">=</span> <span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">for</span> <span class="k">my</span> <span class="nv">$algorithm</span> <span class="p">(</span><span class="nb">keys</span><span class="p">(</span><span class="nv">%sorts</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">print</span> <span class="s">&quot;Running $algorithm test number $count...\n&quot;</span><span class="p">;</span>
            <span class="nv">$result</span><span class="p">{</span><span class="nv">$algorithm</span><span class="p">}</span> <span class="o">=</span> <span class="o">[]</span> <span class="k">unless</span> <span class="nb">defined</span><span class="p">(</span><span class="nv">$result</span><span class="p">{</span><span class="nv">$algorithm</span><span class="p">});</span>
            <span class="nb">push</span><span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$result</span><span class="p">{</span><span class="nv">$algorithm</span><span class="p">}},</span> <span class="n">test_algorithm</span><span class="p">(</span><span class="nv">$algorithm</span><span class="p">,</span> <span class="nv">$array</span><span class="p">,</span> <span class="nv">$i</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">\</span><span class="nv">%result</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">#Builds a CSV string from the results</span>
<span class="k">sub</span> <span class="nf">build_csv</span><span class="p">($)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$result</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">%result</span> <span class="o">=</span> <span class="nv">%$result</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@algorithms</span> <span class="o">=</span> <span class="nb">keys</span><span class="p">(</span><span class="nv">%result</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$current</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@current_result</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$data</span> <span class="o">=</span> <span class="s">&apos;&apos;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;Building a CSV statistics...\n&quot;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nb">scalar</span><span class="p">(</span><span class="nv">@algorithms</span><span class="p">);</span> <span class="nv">$i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$algorithms</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
        <span class="nv">$data</span> <span class="o">.=</span> <span class="nv">$current</span> <span class="o">.</span> <span class="s">&apos;,&apos;</span><span class="p">;</span>
        <span class="nv">@current_result</span> <span class="o">=</span> <span class="nv">@</span><span class="p">{</span><span class="nv">$result</span><span class="p">{</span><span class="nv">$current</span><span class="p">}};</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="nb">scalar</span><span class="p">(</span><span class="nv">@current_result</span><span class="p">);</span> <span class="nv">$j</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$data</span> <span class="o">.=</span> <span class="nv">$current_result</span><span class="p">[</span><span class="nv">$j</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$j</span> <span class="o">&lt;</span> <span class="nb">scalar</span><span class="p">(</span><span class="nv">@current_result</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$data</span> <span class="o">.=</span> <span class="s">&apos;,&apos;</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nv">$data</span> <span class="o">.=</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">MAIN:</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$max</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$array_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$tests_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;Starting $tests_count test cases for all
</span><span class="s">algorithms (&quot;</span> <span class="o">.</span> <span class="nb">join</span><span class="p">(</span><span class="s">&apos;, &apos;</span><span class="p">,</span> <span class="nb">keys</span><span class="p">(</span><span class="nv">%sorts</span><span class="p">))</span> <span class="o">.</span> <span class="s">&quot;) with parementers:
</span><span class="s">arrays with size $array_size, maximum size of each element $max.\n&quot;</span><span class="p">;</span>

    <span class="n">cache_algorithms_source</span><span class="p">();</span>
    <span class="k">my</span> <span class="nv">$result</span> <span class="o">=</span> <span class="n">test_algorithms</span><span class="p">(</span><span class="nv">$tests_count</span><span class="p">,</span> <span class="nv">$array_size</span><span class="p">,</span> <span class="nv">$max</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$csv_result</span> <span class="o">=</span> <span class="n">build_csv</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

    <span class="nb">open</span><span class="p">(</span><span class="n">FH</span><span class="p">,</span> <span class="s">&apos;&gt;result.csv&apos;</span><span class="p">);</span>
    <span class="k">print</span> <span class="n">FH</span> <span class="nv">$csv_result</span><span class="p">;</span>
    <span class="nb">close</span><span class="p">(</span><span class="n">FH</span><span class="p">);</span>
    <span class="k">print</span> <span class="s">&quot;Exiting\n&quot;</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>
<p>If you find any issue in the script please let me know, I&#x2019;ll fix it as soon as possible.
For the test cases I used both &#x2013; different arrays for each algorithm in each test and the same array for each algorithm in each test. I didn&#x2019;t found any difference between both alternatives that&#x2019;s why I choose to generate a single array for each test (for faster testing).</p>
<p>So let me tell you few words about the script because not everyone is familiar with perl and it&#x2019;s syntax. I have three configuration variables: $max, $array_size and $tests_count. $max defines the maximum size of the array&#x2019;s elements, $array_size is the size of the arrays we want to test with and $tests_count is the count of the tests we want to run for each algorithm. For %sorts I set value like: ( Heapsort =&gt; &#x2018;heapsort.js&#x2019;, Default =&gt; &#x2018;default.js&#x2019; ) which means that I want to test Heapsort with filename heapsort.js and the Default sort with script name default.js. For each test case the script generates new array and tests each algorithm with it. Each test is combination of generated array and JavaScript file which contains the sorting algorithm and a line in which the sorting function is being called. In the given script I use Nodejs v0.8.12. In the next cases I&#x2019;ll use the V8 JavaScript engine (V8 version 3.10.8) from the v8 fedora package (except if I haven&#x2019;t mentioned explicitly&#xA0;that I use something different). In all test cases I&#x2019;ll use CPU Intel Corei7 3610QM, 2.3 GHz (except if I haven&#x2019;t mentioned explicitly different CPU) with Fedora 18, x86_64. The content of default.js is:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">array</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">});</span></code></pre></div>
<p>Let start&#x2026;
In the charts below there&#x2019;s a statistic for Selection sort, Insertion sort, Bubble sort, Heapsort, Mergesort and the Default sort (Quick/Insertion).</p>
<div id="attachment_240" style="width: 683px" class="wp-caption alignnone">
  <a href="/images/legacy/uploads2012/11/100-all.png"><amp-img class="size-full wp-image-240" title="All sort algorithms (selection sort, insertion sort, bubble sort, heapsort, mergesort, quicksort, the default sort) with array with 100 elements" src="/images/legacy/uploads2012/11/100-all.png" alt="" width="673" height="385"></amp-img></a><p class="wp-caption-text">
    All sort algorithms (selection sort, insertion sort, bubble sort, heapsort, mergesort, quicksort, the default sort) with arrays with 100 elements
  </p>
</div>
<p>In this first chart there&#x2019;s a statistic with 100 elements. In this case there&#x2019;s almost no difference. The lines are very intertwined but we can see that all sorts have almost the same level of performance.</p>
<div id="attachment_241" style="width: 683px" class="wp-caption alignnone">
  <a href="/images/legacy/uploads2012/11/10k-all.png"><amp-img class="size-full wp-image-241 " title="All sort algorithms (selection sort, insertion sort, bubble sort, heapsort, mergesort, quicksort, the default sort) with array with 10k elements" src="/images/legacy/uploads2012/11/10k-all.png" alt="" width="673" height="385"></amp-img></a><p class="wp-caption-text">
    All sort algorithms (selection sort, insertion sort, bubble sort, heapsort, mergesort, quicksort, the default sort) with array with 10k elements
  </p>
</div>
<p>In the chart above the leaders are almost clear. The default sort is with speed like the mergesort, the heapsort is the fastest. But let&#x2019;s increase the array&#x2026;Let&#x2019;s try with 250k elements:</p>
<div id="attachment_242" style="width: 683px" class="wp-caption alignnone">
  <a href="/images/legacy/uploads2012/11/250k-heap-merge-default.png"><amp-img class="size-full wp-image-242" title="Heapsort vs mergesort vs the default sort 250k elements" src="/images/legacy/uploads2012/11/250k-heap-merge-default.png" alt="" width="673" height="385"></amp-img></a><p class="wp-caption-text">
    Heapsort vs mergesort vs the default sort 250k elements
  </p>
</div>
<p>From the chart it&#x2019;s easy to see that the default sort is slower than the merge and the heap sorts&#x2026;It&#x2019;s very unusual. If you&#x2019;ve ever tried to beat the default sort in Java or STL&#x2026;well it&#x2019;s <del datetime="2012-11-24T17:41:13+00:00">almost</del> impossible.
If we increase the array to more than 300k elements mergesort&#x2019;s performance becomes&#xA0;very bad (more than 10 minutes) so I&#x2019;ll just exclude the mergesort from the next tests.</p>
<p>Let me include one more algorithm implementation. It will be quicksort. Its&#x2019; implementation is like taken from a book, nothing special:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">quickSort</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">function</span> <span class="nx">partition</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">cmp</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="nx">right</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
            <span class="nx">minEnd</span> <span class="o">=</span> <span class="nx">left</span><span class="p">,</span>
            <span class="nx">maxEnd</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">maxEnd</span> <span class="o">=</span> <span class="nx">left</span><span class="p">;</span> <span class="nx">maxEnd</span> <span class="o">&lt;</span> <span class="nx">right</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">maxEnd</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">maxEnd</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nx">cmp</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">swap</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">maxEnd</span><span class="p">,</span> <span class="nx">minEnd</span><span class="p">);</span>
                <span class="nx">minEnd</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">swap</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">minEnd</span><span class="p">,</span> <span class="nx">right</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">minEnd</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">swap</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">temp</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
        <span class="nx">array</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">temp</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">quickSort</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">left</span> <span class="o">&lt;</span> <span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">partition</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">);</span>
            <span class="nx">quickSort</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">p</span><span class="p">);</span>
            <span class="nx">quickSort</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">right</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">quickSort</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}());</span></code></pre></div>
<p>I&#x2019;ll start the test again. The array size will be 500k. The competitors will be quicksort, heapsort and the default sort:</p>
<div id="attachment_243" style="width: 683px" class="wp-caption alignnone">
  <a href="/images/legacy/uploads2012/11/500k-quick-heap-default.png"><amp-img class="size-full wp-image-243" title="Heapsort vs mergesort vs quicksort vs the default sort 500k elements" src="/images/legacy/uploads2012/11/500k-quick-heap-default.png" alt="" width="673" height="385"></amp-img></a><p class="wp-caption-text">
    Heapsort vs mergesort vs quicksort vs the default sort 500k elements
  </p>
</div>
<p>Here is something logical. Quicksort beats heapsort, but the custom (not optimized) quicksort implementation is almost 5 times faster than the default. I guess there&#x2019;s something wrong and maybe the V8 profiler will tell us. I tried to start the native sorting algorithm multiple times with different generated arrays, in a single JavaScript file, because of possible optimizations by the interpreter. The result quicksort vs native with 2 arrays, 1 million elements each, was the same as 2 million elements arrays. So there&#x2019;s not any noticeable optimization.</p>
<p>Here is the last statistic with V8 v3.10.8. The array size this time will be 2 million.</p>
<div id="attachment_244" style="width: 683px" class="wp-caption alignnone">
  <a href="/images/legacy/uploads2012/11/2m-quick-heap-default.png"><amp-img class="size-full wp-image-244" title="Heapsort vs mergesort vs quicksort vs the default sort 2m elements (V8 version 3.10.8)" src="/images/legacy/uploads2012/11/2m-quick-heap-default.png" alt="" width="673" height="385"></amp-img></a><p class="wp-caption-text">
    Heapsort vs mergesort vs quicksort vs the default sort 2m elements (V8 version 3.10.8)
  </p>
</div>
<p>The default sort is more than 5 times slower&#x2026;
In the next chart there&#x2019;s statistics with the V8 engine used by node v0.8.12.</p>
<div id="attachment_245" style="width: 683px" class="wp-caption alignnone">
  <a href="/images/legacy/uploads2012/11/2m-quick-heap-default-node.png"><amp-img class="size-full wp-image-245" title="Heapsort vs mergesort vs quicksort vs the default sort 2m elements (node v0.8.12)" src="/images/legacy/uploads2012/11/2m-quick-heap-default-node.png" alt="" width="673" height="385"></amp-img></a><p class="wp-caption-text">
    Heapsort vs mergesort vs quicksort vs the default sort 2m elements (node v0.8.12)
  </p>
</div>
<p>In the chart above the quicksort custom implementation is again the fastest. The difference is less because of poor performance of the custom implementation of quicksort and faster default sort&#x2026;
If you&#x2019;re interested about the tests with other CPU types please send me a message and I&#x2019;ll post them. The difference is not impressive. With Core2Duo Heapsort&#x2019;s performance is poor than the default sort but quicksort is again almost 1.5 seconds faster, when sorting array with 2 million items (node v0.8.14, under Windows 7).</p>
<p>Lesson learned is that you should not use the default sort in the Google&#x2019;s V8 engine for large arrays of data and multiples sorts. What will be an eventual drawback. Imagine you have a high traffic website. There&#x2019;s large amount of data which you receive each 10 seconds. You need to sort it and process it in any way. Let&#x2019;s say that the data is with 2m records. If you use the default sort you&#x2019;ll loose 5 seconds on each sort, so for two minutes you&#x2019;ll lose 1 minute only for sorting. If you use your custom quicksort implementation each sort will lose about 1 second. For two minutes you&#x2019;re going to lose 12 seconds. For small amount of data it&#x2019;s not a big deal what kind of sorting algorithm you&#x2019;re going to use&#x2026;Even, I think that the default will be more readable and error&#xA0;resistant.</p>
<p>All files used for the test (except the generated ones) can be found <a href="https://github.com/mgechev/v8-sorting-test" target="_blank">here</a>.</p>
</div>

  <aside class="p-share">
  <a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.mgechev.com%2f2012%2f11%2f24%2fjavascript-sorting-performance-quicksort-v8%2f&amp;t=Looking%20for%20performance%3f%20Probably%20you%20should%20NOT%20use%20%5b%5d.sort%20%28V8%29" title="Facebook&#x3067;&#x30B7;&#x30A7;&#x30A2;" class="fb" target="_blank" rel="nofollow"></a>
  <a href="http://twitter.com/intent/tweet?url=https%3a%2f%2fblog.mgechev.com%2f2012%2f11%2f24%2fjavascript-sorting-performance-quicksort-v8%2f&amp;text=Looking%20for%20performance%3f%20Probably%20you%20should%20NOT%20use%20%5b%5d.sort%20%28V8%29&amp;tw_p=tweetbutton" title="Twitter&#x3067;&#x30B7;&#x30A7;&#x30A2;" class="tw" target="_blank" rel="nofollow"></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fblog.mgechev.com%2f2012%2f11%2f24%2fjavascript-sorting-performance-quicksort-v8%2f" title="Google Plus&#x3067;&#x30B7;&#x30A7;&#x30A2;" class="gp" target="_blank" rel="nofollow"></a>
</aside>


  <footer class="article-footer">
    <section>
      <ol class="p-crumb">
        <li><a href="https://blog.mgechev.com/">Minko Gechev&apos;s blog</a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="https://blog.mgechev.com/post/" itemprop="url"><span itemprop="title">post</span></a></li>
        
        <li>Looking for performance? Probably you should NOT use [].sort (V8)</li>
      </ol>

      
      
      
      <ul class="p-facts">
        <li>
          <header><a href="https://blog.mgechev.com/categories/">categories</a></header>
          <ul>
            
            <li><a href="https://blog.mgechev.com/categories/Algorithms/">Algorithms</a></li>
            
            <li><a href="https://blog.mgechev.com/categories/Browsers/">Browsers</a></li>
            
            <li><a href="https://blog.mgechev.com/categories/Development/">Development</a></li>
            
            <li><a href="https://blog.mgechev.com/categories/JavaScript/">JavaScript</a></li>
            
            <li><a href="https://blog.mgechev.com/categories/Linux/">Linux</a></li>
            
            <li><a href="https://blog.mgechev.com/categories/OpenSource/">OpenSource</a></li>
            
            <li><a href="https://blog.mgechev.com/categories/Performance/">Performance</a></li>
            
            <li><a href="https://blog.mgechev.com/categories/Sorting/">Sorting</a></li>
            
            <li><a href="https://blog.mgechev.com/categories/Webkit/">Webkit</a></li>
            
          </ul>
        </li>
      </ul>
      
      
      
      <ul class="p-facts">
        <li>
          <header><a href="https://blog.mgechev.com/tags/">tags</a></header>
          <ul>
            
            <li><a href="https://blog.mgechev.com/tags/Algorithms/">Algorithms</a></li>
            
            <li><a href="https://blog.mgechev.com/tags/Development/">Development</a></li>
            
            <li><a href="https://blog.mgechev.com/tags/Heapsort/">Heapsort</a></li>
            
            <li><a href="https://blog.mgechev.com/tags/JavaScript/">JavaScript</a></li>
            
            <li><a href="https://blog.mgechev.com/tags/Mergesort/">Mergesort</a></li>
            
            <li><a href="https://blog.mgechev.com/tags/performance/">performance</a></li>
            
            <li><a href="https://blog.mgechev.com/tags/Programming/">Programming</a></li>
            
            <li><a href="https://blog.mgechev.com/tags/Quicksort/">Quicksort</a></li>
            
            <li><a href="https://blog.mgechev.com/tags/Sorting/">Sorting</a></li>
            
          </ul>
        </li>
      </ul>
      
      
    </section>
  </footer>
</article>



  
  
  <section>
    <header><span>Latests</span></header>
    <ul class="p-articles thin">
      <li><article class="li sm article-ca9732109bba36edeb73a95cf4b88e80">
  <div class="header-wrapper">
    <a href="https://blog.mgechev.com/2024/05/28/are-llms-going-to-replace-us/" class="thumbnail" title="Are LLMs going to replace us?"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="https://blog.mgechev.com/2024/05/28/are-llms-going-to-replace-us/">Are LLMs going to replace us?</a></h2>
        <ul class="p-facts">
          <li><time datetime="2024-05-28T00:00:00JST">May 28, 2024</time></li>
          <li><a href="https://blog.mgechev.com/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-799ec12f87a7c78102f87a50fa2a6270">
  <div class="header-wrapper">
    <a href="https://blog.mgechev.com/2021/02/07/prefetching-strategies-heuristics-faster-web-apps/" class="thumbnail" title="Prefetching Heuristics"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="https://blog.mgechev.com/2021/02/07/prefetching-strategies-heuristics-faster-web-apps/">Prefetching Heuristics</a></h2>
        <ul class="p-facts">
          <li><time datetime="2021-02-07T00:00:00JST">Feb 7, 2021</time></li>
          <li><a href="https://blog.mgechev.com/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-1f356350658bf1f680bcc8a78b3ccae4">
  <div class="header-wrapper">
    <a href="https://blog.mgechev.com/2021/01/24/design-pattens-in-open-source-projects-part-ii/" class="thumbnail" title="Design Patterns in Open Source Projects - Part II"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="https://blog.mgechev.com/2021/01/24/design-pattens-in-open-source-projects-part-ii/">Design Patterns in Open Source Projects - Part II</a></h2>
        <ul class="p-facts">
          <li><time datetime="2021-01-24T00:00:00JST">Jan 24, 2021</time></li>
          <li><a href="https://blog.mgechev.com/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li>
    </ul>
  </section>
  
</div>


    </main>

    

    <footer class="l-footer">
      <div class="l-container">
        <p><span class="h-logo">&#xA9; Minko Gechev&apos;s blog</span></p>
      </div>
    </footer>

    <a href="#" class="p-movetop" title="&#x30DA;&#x30FC;&#x30B8;&#x4E0A;&#x90E8;&#x3078;&#x623B;&#x308B;" rel="nofollow"></a>
  </body>
</html>

