<!DOCTYPE html>
<html ⚡>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="theme-color" content="#263238">

<meta name="generator" content="Hugo 0.22-DEV" />

<link rel="apple-touch-icon" href="http://blog.mgechev.com/amp/images/logo.png">


<link rel="canonical" href="http://blog.mgechev.com/amp/2014/02/05/angularjs-resource-active-record-http/">


    
    <link href="https://fonts.googleapis.com/css?family=Lobster|Lato:400,700" rel="stylesheet">
    
    <title>The magic of $resource (or simply a client-side Active Record) - Minko Gechev&#39;s blog</title>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    
    
<meta name="description" content="At first sight AngularJS seems like a magical framework, which does some weird but awesome things like dependency injection, data binding only by setting a single property to the magical object named $scope and many other things.If you look at the source code of Angular you’ll see a lot of smart and simple solutions for these magical problems. In this blog post I’ll describe the magic which stays behind $resource.">

<meta property="og:title" content="The magic of $resource (or simply a client-side Active Record) - Minko Gechev&#39;s blog">
<meta property="og:type" content="article">
<meta property="og:url" content="http://blog.mgechev.com/amp/2014/02/05/angularjs-resource-active-record-http/">
<meta property="og:site_name" content="Minko Gechev&#39;s blog">
<meta property="og:description" content="At first sight AngularJS seems like a magical framework, which does some weird but awesome things like dependency injection, data binding only by setting a single property to the magical object named $scope and many other things.If you look at the source code of Angular you’ll see a lot of smart and simple solutions for these magical problems. In this blog post I’ll describe the magic which stays behind $resource.">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="Minko Gechev&#39;s blog">
<meta name="twitter:url" content="http://blog.mgechev.com/amp/2014/02/05/angularjs-resource-active-record-http/">
<meta name="twitter:title" content="The magic of $resource (or simply a client-side Active Record) - Minko Gechev&#39;s blog">
<meta name="twitter:description" content="At first sight AngularJS seems like a magical framework, which does some weird but awesome things like dependency injection, data binding only by setting a single property to the magical object named $scope and many other things.If you look at the source code of Angular you’ll see a lot of smart and simple solutions for these magical problems. In this blog post I’ll describe the magic which stays behind $resource.">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"http://blog.mgechev.com/amp/"
    },
    "headline": "The magic of $resource (or simply a client-side Active Record) - Minko Gechev&#39;s blog",
    "datePublished": "2014-02-05T00:00:00JST",
    "dateModified": "2014-02-05T00:00:00JST",
    "author": {
      "@type": "Person",
      "name": "Minko Gechev&#39;s blog"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Minko Gechev&#39;s blog",
      "logo": {
        "@type": "ImageObject",
        "url": "http://blog.mgechev.com/amp/images/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "At first sight AngularJS seems like a magical framework, which does some weird but awesome things like dependency injection, data binding only by setting a single property to the magical object named $scope and many other things.
If you look at the source code of Angular you’ll see a lot of smart and simple solutions for these magical problems. In this blog post I’ll describe the magic which stays behind $resource."
  }
</script>


    <style amp-custom>
      html { font-size: 18px;}@media (max-width: 768px) { html { font-size: 15px; }}body { font-family: Lato,'Hiragino Kaku Gothic Pro',メイリオ,Meiryo,sans-serif; font-size: inherit; margin: 0; color: #263238;}html, body { margin: 0;}a { text-decoration: none; color: #e91e63;}p { margin: 0;}ul,ol { margin: 0; padding: 0;}h1, h2, h3, h4, h5, h6 { margin: 0; font-weight: 700;}h1 { font-size: 1.8rem; line-height: 2rem; margin: 1.5rem 0; }h2 { font-size: 1.4rem; line-height: 2rem; margin: 1.5rem 0; }h3 { font-size: 1.2rem; line-height: 1.5rem; margin: 1.5rem 0; }h4, h5, h6 { font-size: 1rem; line-height: 1.5rem; margin: 1.5rem 0; }.clearfix::after { content: ''; display: block; clear: both;}main { display: block;}/* Layouts */.l-header { padding: .5rem 0; margin-bottom: 2rem; border-bottom: 1px dashed #cfd8dc; text-align: center;}.l-footer { font-size: .8rem; padding: 1rem 0; border-top: 1px dashed #cfd8dc;}.l-container { max-width: 42rem; margin: 0 auto; padding: 0 1rem;}/* Parts:logo */.p-logo { font-family: Lobster, cursive;}.p-logo a { color: #000; font-size: 1.6rem; line-height: 2rem;}/* Parts:section */section { border-top: 2px solid #eceff1; padding: 1.5rem 0;}section>header { text-transform: uppercase; font-weight: 700; margin-bottom: 2rem; text-align: center;}section>header span { display: inline-block; background-color: #000; color: #fff; letter-spacing: 3px; font-size: .7rem; padding: .5rem .75rem;}/* Parts:facts */.p-facts { list-style: none; font-size: .8rem; margin-bottom: 1rem;}.p-facts:last-child { margin-bottom: 0;}.p-facts li { display: inline-block; margin-right: .5rem; text-transform: uppercase;}.p-facts li header { margin-bottom: .25rem; font-weight: 700;}.p-facts li header a { color: #000; text-decoration: underline;}.p-facts li li { display: inline-block; margin-right: .5rem;}.p-facts li li::after { content: ',';}.p-facts li li:last-child::after { content: '';}/* Parts:crumb */.p-crumb { list-style: none; margin-bottom: 1rem; font-size: .8rem; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}.p-crumb:last-child { margin-bottom: 0;}.p-crumb li { display: inline;}.p-crumb li::after { content: '›'; margin: 0 .5rem;}.p-crumb li:last-child::after { content: '';}/* Parts:page-title */.p-page-title { margin-bottom: 2rem;}.p-page-title .title { margin-bottom: .5rem;}/* Parts:share */.p-share { margin-bottom: 1.5rem;}.p-share a { display: inline-block; text-align: center; padding: .5rem .5rem; margin-right: .25rem; font-size: .6rem; background-color: #eceff1; font-weight: 700k}.p-share a.ht { color: #00a4de; }.p-share a.fb { color: #3b5998; }.p-share a.tw { color: #1da1f2; }.p-share a.gp { color: #dd4b39; }.p-share a.ln { color: #00c300; }.p-share a.ht::before { content: 'Hatena'; }.p-share a.fb::before { content: 'Facebook'; }.p-share a.tw::before { content: 'Twitter'; }.p-share a.gp::before { content: 'Google+'; }.p-share a.ln::before { content: 'LINE'; }/* Parts:terms */.p-terms { padding-left: 2rem;}/* Parts:paginator */.p-paginator { text-align: center; margin-bottom: 3rem; padding-top: 2rem;}.p-paginator a { display: inline-block; border: 2px solid #eceff1; color: #263238; line-height: 2rem; padding: 0 1rem;}/* Parts:article */.p-articles { list-style: none;}.p-articles>li { margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px dashed #cfd8dc;}.p-articles>li:last-child { border-bottom: none; padding-bottom: 0;}.p-articles.thin>li { margin-bottom: 1rem; padding-bottom: 1rem;}article .article-header { display: table-cell; height: 6rem; vertical-align: middle;}article .title { margin: 0; margin-bottom: .5rem; font-size: 1.4rem; line-height: 2rem;}article .title a { color: #000;}article .header-wrapper { margin-bottom: 1.5rem;}article .thumbnail { display: none;}article .summary { margin-bottom: 1.5rem;}article .readmore { text-align: center;}article .readmore a { font-size: .8rem; color: #000; text-decoration: underline;}article.li.sm .header-wrapper { margin-bottom: 0;}.article-body h2 { padding: 1rem 0; border-bottom: 2px solid #eceff1;}.article-body h2:first-child { margin-top: 0; }.article-body h3 { color: #cddc39;}.article-body h4 { border-left: solid .25rem #cddc39; padding: 0 .5rem;}.article-body p { margin: 1.5rem 0; line-height: 1.5rem;}.article-body a { text-decoration: underline;}.article-body ul,.article-body ol { padding-left: 1.5rem;}.article-body code { display: inline-block; font-family: Menlo, consolas, monospace; background-color: #eceff1; font-size: .8rem; padding: 0 .5rem; line-height: 1.5rem;}.article-body pre { margin: 1.5rem 0; padding: 1.5rem; font-size: .8rem; background-color: #263238; color: #fff; overflow: auto;}.article-body pre code { background-color: transparent;}.article-body blockquote { margin: 1.5rem 0; padding: .5rem 0; font-size: .8rem; border-top: 1px solid #eceff1; border-bottom: 1px solid #eceff1; color: #607d8b;}.article-body blockquote p { margin: .5rem 0; line-height: 1rem;}.article-body strong { box-shadow: 0 -.5rem 0 0 #f06292 inset;}.article-body em { font-style: normal; font-weight: 700; color: #ff5722;}.article-body figure { margin: 1.5rem -2rem; }.article-body figure.left,.article-body figure.right { width: 15rem; height: 12rem; margin-top: 0; margin-left: 0; margin-right: 0;}.article-body figure.left { float: left; margin-right: 1rem; margin-left: -2rem; }.article-body figure.right { float: right; margin-left: 1rem; margin-right: -2rem; }@media (max-width: 768px) { .article-body figure { margin: 1.5rem -1rem; } .article-body figure.left, .article-body figure.right { float: none; margin: 0 -1rem; width: auto; height: auto; }}.article-body figcaption { padding: .5rem 0; font-size: .8rem; text-align: center;}.article-body figcaption a { color: #263238;}

      
    </style>
  </head>

  <body>
    
    
    <amp-analytics type="googleanalytics" id="analytics1">
      <script type="application/json">
        {
          "vars": {
            "account": "UA-18060688-3"
          },
          "triggers": {
            "trackPageview": {
              "on": "visible",
              "request": "pageview"
            }
          }
        }
      </script>
    </amp-analytics>
    
    

    <header class="l-header">
      <div class="l-container">
        <div class="h-logo p-logo">
          <a href="http://blog.mgechev.com/amp/" class="h-logo">Minko Gechev&#39;s blog</a>
        </div>
      </div>
    </header>

    <main>
      
<div class="l-container">
  <article class="single article-987061f98c44d2e5b19224a8386c8fa3">
  <div class="header-wrapper">
    <a href="http://blog.mgechev.com/amp/2014/02/05/angularjs-resource-active-record-http/" class="thumbnail" title="The magic of $resource (or simply a client-side Active Record)"></a>
    <header class="article-header">
      <div class="clearfix">
        <h1 class="title">The magic of $resource (or simply a client-side Active Record)</h1>
        <ul class="p-facts">
          <li><time datetime="2014-02-05T00:00:00JST">Feb 5, 2014</time></li>
          <li><a href="http://blog.mgechev.com/amp/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>

  <aside class="p-share">
  <a href="http://www.facebook.com/sharer.php?u=http%3a%2f%2fblog.mgechev.com%2famp%2f2014%2f02%2f05%2fangularjs-resource-active-record-http%2f&t=The%20magic%20of%20%24resource%20%28or%20simply%20a%20client-side%20Active%20Record%29" title="Facebookでシェア" class="fb" target="_blank" rel="nofollow"></a>
  <a href="http://twitter.com/intent/tweet?url=http%3a%2f%2fblog.mgechev.com%2famp%2f2014%2f02%2f05%2fangularjs-resource-active-record-http%2f&text=The%20magic%20of%20%24resource%20%28or%20simply%20a%20client-side%20Active%20Record%29&tw_p=tweetbutton" title="Twitterでシェア" class="tw" target="_blank" rel="nofollow"></a>
  <a href="https://plus.google.com/share?url=http%3a%2f%2fblog.mgechev.com%2famp%2f2014%2f02%2f05%2fangularjs-resource-active-record-http%2f" title="Google Plusでシェア" class="gp" target="_blank" rel="nofollow"></a>
</aside>


  <div class="article-body">

<p>At first sight AngularJS seems like a magical framework, which does some weird but awesome things like dependency injection, data binding only by setting a single property to the magical object named $scope and many other things.</p>

<p>If you look at the source code of Angular you’ll see a lot of smart and simple solutions for these magical problems. In this blog post I’ll describe the magic which stays behind <code>$resource</code>. I decided to write this blog post because of my recent experience in StackOverflow. One of the most misunderstood components of AngularJS was exactly the <code>$resource</code> service. <code>$resource</code> is two levels of abstraction above the XMLHttpRequest object (ok, may be three if we count <code>$httpBackend</code>). I’ve illustrated the usage of <code>$resource</code> through example which can be found at <a href="https://github.com/mgechev/angularjs-resource">GitHub</a>.</p>

<p>Before continuing with <code>$resource</code> I’m going to explain few important concepts. The first one is:</p>

<h3 id="active-record">Active Record</h3>

<p>This is architectural pattern named by Martin Fowler. The Active Record object is an object, which carries both data and behavior. Usually most of the data in these objects is persistent, responsibility of the Active Record object is to take care of the communication with the database in order to create, update, retrieve or delete the data. It may delegate this responsibility to lower level classes but calls to instance or static methods of the active record object cause the database communication.</p>

<p>For example:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">function</span> <span class="nx">User</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">age</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">User</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">save</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span><span class="s1">&#39;INSERT INTO User (name, age) VALUES (&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="nx">User</span><span class="p">.</span><span class="nx">query</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM User&#39;</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>


<p>In the example above we have <code>User</code> constructor function, which also has methods <code>query</code> and <code>save</code>. We can use it by:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">//user.id is now available</span>
<span class="p">});</span>

<span class="nx">User</span><span class="p">.</span><span class="nx">query</span><span class="p">()</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">//all users</span>
<span class="p">});</span>
</code></pre></div>


<p>In the client-side JavaScript everything is a little bit different but the concepts are the same. What are the problems of this pattern? Well, in the relational databases we work with relations, which are represented as tables. We don’t have the standard OO concepts such as inheritance or association. Of course, we can emulate them by using tables but this leads to a problem – we don’t have 1:1 mapping between our tables and classes. Thats why sometimes for ORM is preferred the pattern <a href="http://www.martinfowler.com/eaaCatalog/dataMapper.html">Data Mapper</a>, but topic is out of the scope of the current post. Fortunately, in the Single-Page Applications, usually we have back-end, which probably uses ORM framework and provides us a nice JSON API, so we don’t have to worry about complex mapping, we can just use client-side Active Record.</p>

<h3 id="lexical-functional-scope">Lexical functional scope</h3>

<p>This is very basic JavaScript concept but also one used in <code>$resource</code>. As you see in the <code>save</code> method, in example above, we keep reference to <code>this</code> in <code>self</code>. This reference is visible in the callback we pass to the promise returned by <code>db.process</code>. When the promise is resolved we just populate the missing data (in this case <code>id</code>) and return the object.</p>

<p>We can do something similar in <code>query</code></p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">User</span><span class="p">.</span><span class="nx">query</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="p">[];</span>
   <span class="nx">users</span><span class="p">.</span><span class="nx">$promise</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM User&#39;</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">collection</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">collection</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">users</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
   <span class="k">return</span> <span class="nx">users</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>


<p>In this case when <code>User.query()</code> is called it immediately returns an empty array with property <code>$promise</code>. When the promise is resolved (i.e. database request successfully completed), we just push each of the users into our array <code>users</code>. Note that the user of our code already has reference to this variable, so when we populate it he will be able to use all the data immediately.</p>

<h3 id="digest-loop">$digest loop</h3>

<p>The last thing we will look at before continuing with <code>$resource</code> is AngularJS’s <code>$digest</code> loop. Probably you’re aware that when AngularJS finds some “special” directives in our templates it automatically registers watchers for the expressions used in these directives. Such “special” directives are <code>{{ }}</code>, <code>ng-model</code>, <code>ng-bind</code>. When something cause call of the digest loop AngularJS iterates over all watched expressions and calculates their values until there are no more changes (when we have wider support of <code>Object.observe</code>, probably the <code>$digest</code> loop will be more smarter and efficient).</p>

<p>So if we have:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">function</span> <span class="nx">MainCtrl</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">users</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">}</span>
</code></pre></div>


<p>with the following markup:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">ng-controller</span><span class="o">=</span><span class="s">&quot;MainCtrl&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">ng-repeat</span><span class="o">=</span><span class="s">&quot;user in users&quot;</span><span class="p">&gt;</span>{{user.name}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></div>


<p>Now if somewhere else, something keeps the reference to the <code>users</code> array it can simply:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">$scope</span><span class="p">.</span><span class="nx">$apply</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">users</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;foo&#39;</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>


<p>which will cause rendering of a single list item with the value <code>&quot;foo&quot;</code>.</p>

<h1 id="resource">$resource</h1>

<p>We won’t cover the whole API of <code>$resource</code> but we will look at how we can implement our model (<strong>not</strong> view model) with it. First of all, lets suppose we have a nice RESTful API for creating, retrieving, updating and deleting users:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>POST   /users
POST   /users/:id # We won&#39;t use PUT, but we can
DELETE /users/:id
GET    /users
GET    /users/:id
</code></pre></div>


<p>Now we can create our model by:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">&#39;/users/:id&#39;</span><span class="p">);</span>
</code></pre></div>


<p><code>$resource</code> will create a constructor function for our model instances. Each of the model instances will have methods, which could be used for the different CRUD operation&hellip;and that’s all?! We implemented the communication with the back-end by invoking <code>$resource</code> with a single parameter!</p>

<p>But how about custom actions like <code>login</code>, for example? The <code>$resource</code> API allows us to <a href="http://docs.angularjs.org/api/ngResource.$resource">include them</a> explicitly.</p>

<p>I would recommend you to wrap the constructor function produced by <code>$resource</code> in a service. You will be able to reuse it across the application, mock it easier when writing tests and extend its functionality without modifying additional code (we follow the open-closed principle):</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$resource</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">&#39;/users/:id&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>


<p>Now let’s get all users:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">resourceDemo</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;MainCtrl&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">User</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">users</span> <span class="o">=</span> <span class="nx">User</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>


<p>And now visualize all users&hellip;:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="o">&lt;</span><span class="nx">table</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">tr</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">repeat</span><span class="o">=</span><span class="s2">&quot;user in users&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}}</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
    <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">href</span><span class="o">=</span><span class="s2">&quot;#/users/{{user.id}}&quot;</span><span class="o">&gt;</span><span class="p">{{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}}</span><span class="o">&lt;</span><span class="err">/a&gt;&lt;/td&gt;</span>
    <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="nx">user</span><span class="p">.</span><span class="nx">job</span><span class="p">}}</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
  <span class="o">&lt;</span><span class="err">/tr&gt;</span>
<span class="o">&lt;</span><span class="err">/table&gt;</span>
</code></pre></div>


<p>You might think that the operation <code>query</code> is synchronous because of the way we set the value of <code>$scope.users</code>. This will be very bad, right? Well, it is asynchronous, <code>MainCtrl</code> simply uses two of the concepts we discussed above: functional lexical scope, <code>$digest</code> loop.<br />
When the <code>query</code> method is invoked it returns a reference to an empty array, the array has just a single property called <code>$promise</code>, you can use it if you want to manipulate the users after the request was successful, or not. When the request completes AngularJS populates the array with all users and calls the <code>$digest</code> loop. The <code>query</code> action will make a GET request to <code>/users</code>.</p>

<p>There is something cool in AngularJS’s route definition, which allows us to change the current page once all dependencies of the next page are resolved – the <code>resolve</code> hash. This feature is very helpful especially if we want to open a page with single user view:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="c1">//...</span>
<span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;/users/:userid&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;partials/user.html&#39;</span><span class="p">,</span>
  <span class="nx">controller</span><span class="o">:</span> <span class="s1">&#39;UserCtrl&#39;</span><span class="p">,</span>
  <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$route</span><span class="p">,</span> <span class="nx">User</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">User</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span> <span class="nx">userid</span><span class="o">:</span> <span class="nx">$route</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">userid</span> <span class="p">}).</span><span class="nx">$promise</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="c1">//...</span>
</code></pre></div>


<p>As I mentioned above, when we invoke “static” method of the constructor function, it returns an empty object with property <code>$promise</code>, which will be resolved once the request is completed. This way we make sure the user will see the page once the user with id <code>$route.current.params.userid</code> is available.</p>

<p>And this is our <code>User</code> controller:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">resourceDemo</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;UserCtrl&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>


<p>You may noticed the <code>setTimeout</code> which is added in the express web app. It cause slower response, only to illustrate how useful could be our next enhancement – cache. We can cache some requests by passing additional parameters to the <code>$resource</code> function. For example:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">resourceDemo</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$cacheFactory</span><span class="p">,</span> <span class="nx">$resource</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">&#39;/users/:userid&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="p">{</span> <span class="nx">cache</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;get&#39;</span> <span class="p">}</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">User</span><span class="p">;</span>
<span class="p">})</span>
</code></pre></div>


<p>The example above will make each call of the <code>get</code> method cachable (it won’t affect the <code>query</code> method). After adding this line you’ll notice that, after the first time, on each subsequent click on somebody’s name you’ll be immediately redirected to the user’s view, you won’t have to wait the request to complete because AngularJS does not make any requests – it takes the value from the cache.</p>

<p>Most of these methods also accept callbacks, but I would recommend you to stick to the promisee usage.</p>

<p>Once again – you can grab the <a href="https://github.com/mgechev/angularjs-resource">sample application here</a>.</p>

<h2 id="conclusion">Conclusion</h2>

<p><code>$resource</code> allows us to use Active Record like pattern of communication with our RESTful service. It will definitely save you a lot of lines of code, if your back-end provides proper API. It gives you features like caching, interceptors, specifying response type and timeout, it even provides flag “<a href="https://developer.mozilla.org/en-US/docs/HTTP/Access_control_CORS?redirectlocale=en-US&amp;redirectslug=HTTP_access_control#Requests_with_credentials">with credentials</a>“.</p>

<p>However, when you have more complex/custom back-end API, you may consider to implement all the communication by your own since, otherwise, you’ll need to override most of the methods of <code>$resource</code>, anyway.</p>
</div>

  <aside class="p-share">
  <a href="http://www.facebook.com/sharer.php?u=http%3a%2f%2fblog.mgechev.com%2famp%2f2014%2f02%2f05%2fangularjs-resource-active-record-http%2f&t=The%20magic%20of%20%24resource%20%28or%20simply%20a%20client-side%20Active%20Record%29" title="Facebookでシェア" class="fb" target="_blank" rel="nofollow"></a>
  <a href="http://twitter.com/intent/tweet?url=http%3a%2f%2fblog.mgechev.com%2famp%2f2014%2f02%2f05%2fangularjs-resource-active-record-http%2f&text=The%20magic%20of%20%24resource%20%28or%20simply%20a%20client-side%20Active%20Record%29&tw_p=tweetbutton" title="Twitterでシェア" class="tw" target="_blank" rel="nofollow"></a>
  <a href="https://plus.google.com/share?url=http%3a%2f%2fblog.mgechev.com%2famp%2f2014%2f02%2f05%2fangularjs-resource-active-record-http%2f" title="Google Plusでシェア" class="gp" target="_blank" rel="nofollow"></a>
</aside>


  <footer class="article-footer">
    <section>
      <ol class="p-crumb">
        <li><a href="http://blog.mgechev.com/amp/">Minko Gechev&#39;s blog</a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="http://blog.mgechev.com/amp/post/" itemprop="url"><span itemprop="title">post</span></a></li>
        
        <li>The magic of $resource (or simply a client-side Active Record)</li>
      </ol>

      
      
      
      <ul class="p-facts">
        <li>
          <header><a href="http://blog.mgechev.com/amp/categories/">categories</a></header>
          <ul>
            
            <li><a href="http://blog.mgechev.com/amp/categories/AngularJS/">AngularJS</a></li>
            
            <li><a href="http://blog.mgechev.com/amp/categories/Development/">Development</a></li>
            
            <li><a href="http://blog.mgechev.com/amp/categories/Http/">Http</a></li>
            
            <li><a href="http://blog.mgechev.com/amp/categories/JavaScript/">JavaScript</a></li>
            
            <li><a href="http://blog.mgechev.com/amp/categories/Node.js/">Node.js</a></li>
            
            <li><a href="http://blog.mgechev.com/amp/categories/Object-Oriented-Programming/">Object-Oriented Programming</a></li>
            
            <li><a href="http://blog.mgechev.com/amp/categories/Patterns/">Patterns</a></li>
            
            <li><a href="http://blog.mgechev.com/amp/categories/Programming/">Programming</a></li>
            
            <li><a href="http://blog.mgechev.com/amp/categories/Web-development/">Web development</a></li>
            
          </ul>
        </li>
      </ul>
      
      
      
      <ul class="p-facts">
        <li>
          <header><a href="http://blog.mgechev.com/amp/tags/">tags</a></header>
          <ul>
            
            <li><a href="http://blog.mgechev.com/amp/tags/active-record/">active record</a></li>
            
            <li><a href="http://blog.mgechev.com/amp/tags/AngularJS/">AngularJS</a></li>
            
            <li><a href="http://blog.mgechev.com/amp/tags/Design-patterns/">Design patterns</a></li>
            
            <li><a href="http://blog.mgechev.com/amp/tags/Development/">Development</a></li>
            
            <li><a href="http://blog.mgechev.com/amp/tags/JavaScript/">JavaScript</a></li>
            
          </ul>
        </li>
      </ul>
      
      
    </section>
  </footer>
</article>



  
  
  <section>
    <header><span>Latests</span></header>
    <ul class="p-articles thin">
      <li><article class="li sm article-43672564696ee352fbf3cd0b906f1e8b">
  <div class="header-wrapper">
    <a href="http://blog.mgechev.com/amp/2018/01/18/react-typescript-redux-immutable/" class="thumbnail" title="3 Tricks For Using Redux and Immutable.js with TypeScript"></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="http://blog.mgechev.com/amp/2018/01/18/react-typescript-redux-immutable/">3 Tricks For Using Redux and Immutable.js with TypeScript</a></h2>
        <ul class="p-facts">
          <li><time datetime="2018-01-18T00:00:00JST">Jan 18, 2018</time></li>
          <li><a href="http://blog.mgechev.com/amp/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-6a8d6cd1d272696bfc05f90632f00f22">
  <div class="header-wrapper">
    <a href="http://blog.mgechev.com/amp/2017/12/28/career-development-open-source-get-started/" class="thumbnail" title="Follow Your Dream Career with Open Source. Personal Story."></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="http://blog.mgechev.com/amp/2017/12/28/career-development-open-source-get-started/">Follow Your Dream Career with Open Source. Personal Story.</a></h2>
        <ul class="p-facts">
          <li><time datetime="2017-12-28T00:00:00JST">Dec 28, 2017</time></li>
          <li><a href="http://blog.mgechev.com/amp/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li><li><article class="li sm article-6462257f7dffe7a4f4bc80054188e5d5">
  <div class="header-wrapper">
    <a href="http://blog.mgechev.com/amp/2017/12/07/redux-anti-patterns-race-conditions-state-management-duplication/" class="thumbnail" title="Redux Anti-Patterns - Part 1. State Management."></a>
    <header class="article-header">
      <div class="clearfix">
        <h2 class="title"><a href="http://blog.mgechev.com/amp/2017/12/07/redux-anti-patterns-race-conditions-state-management-duplication/">Redux Anti-Patterns - Part 1. State Management.</a></h2>
        <ul class="p-facts">
          <li><time datetime="2017-12-07T00:00:00JST">Dec 7, 2017</time></li>
          <li><a href="http://blog.mgechev.com/amp/post/">post</a></li>
          
        </ul>
      </div>
    </header>
  </div>
</article>
</li>
    </ul>
  </section>
  
</div>


    </main>

    

    <footer class="l-footer">
      <div class="l-container">
        <p><span class="h-logo">&copy; Minko Gechev&#39;s blog</span></p>
      </div>
    </footer>

    <a href="#" class="p-movetop" title="ページ上部へ戻る" rel="nofollow"></a>
  </body>
</html>

