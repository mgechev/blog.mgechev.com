    <!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		
		<meta name="generator" content="Hugo 0.121.1">
		<title>3 Tricks For Using Redux and Immutable.js with TypeScript &middot; Minko Gechev&#39;s blog</title>
		<link rel="shortcut icon" href="https://blog.mgechev.com/images/favicon.ico">
		<link rel="stylesheet" href="https://blog.mgechev.com/css/highlight.css">
		<link rel="stylesheet" href="https://blog.mgechev.com/css/style.css">
		

		
		<link rel="stylesheet" href="https://blog.mgechev.com/css/font-awesome.min.css">
		

		
		<link href="https://blog.mgechev.com/feed.xml" rel="alternate" type="application/rss+xml" title="Minko Gechev&#39;s blog">
		
		
		<link rel="amphtml" href="https://blog.mgechev.com/amp/2018/01/18/react-typescript-redux-immutable/">
		

		<meta property="og:title" content="3 Tricks For Using Redux and Immutable.js with TypeScript" />
		<meta property="og:description" content="In this post, I&rsquo;ll show you a few tricks which can make your life using Immutable.js and Redux with TypeScript easier. All the practices are inspired by my recent work on the project Rhyme.com.
Immutable Statically Typed Records Let&rsquo;s start with the definition of our store. For the purpose I prefer to use Immutable records because of two main reasons:
Immutable stores make the mutation more explicit and well organized. Records allow convenient property access." />
		<meta property="og:type" content="article" />
		<meta property="og:url" content="https://blog.mgechev.com/2018/01/18/react-typescript-redux-immutable/" />
		
		<meta property="og:image" content="https://blog.mgechev.com/images/myself.jpg"/>
		<meta property="og:image:secure_url" content="https://blog.mgechev.com/images/myself.jpg"/>
		
	</head>

    <body>
       <nav class="main-nav">
  
  <div class="link-wrapper">
	
	
		<a href='https://blog.mgechev.com/'> <span class="arrow">←</span>Home</a>
	
	<a href='https://blog.mgechev.com/post'>Posts</a>
	<a href='https://blog.mgechev.com/about'>About</a>
	<a href='https://blog.mgechev.com/talks'>Speaking</a>
  </div>

	

	
  
	
</nav>
<a href="https://github.com/mgechev" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="z-index: 100000; fill:#70B7FD; color:#fff; position: fixed; top: 20px; border: 0; left: 20px; transform: scale(-1.5, 1.5);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>


        <section id="wrapper">
            <article class="post">
                <header>
                    <h1>
                        3 Tricks For Using Redux and Immutable.js with TypeScript
                    </h1>
                    <h2 class="headline">
                    <a href="https://github.com/mgechev/blog.mgechev.com/tree/master/content/post/2018-01-18-react-typescript-redux-immutable.md">
                        <i class="fa fa-pencil-square-o"></i> Edit
                    </a>
                    · Jan 18, 2018
                    · 8 minutes read
                    · <a href="https://twitter.com/mgechev?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="true">Follow @mgechev</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                      <span class="tags">
                      
                      
                          
                              <a href="https://blog.mgechev.com/tags/typescript">TypeScript</a>
                          
                              <a href="https://blog.mgechev.com/tags/redux">Redux</a>
                          
                              <a href="https://blog.mgechev.com/tags/immutable.js">Immutable.js</a>
                          
                      
                      
                      </span>
                    </h2>
                </header>
                
                <section id="post-body">
                    <p>In this post, I&rsquo;ll show you a few tricks which can make your life using Immutable.js and Redux with TypeScript easier. All the practices are inspired by my recent work on the project <a href="https://rhyme.com">Rhyme.com</a>.</p>
<h1 id="immutable-statically-typed-records">Immutable Statically Typed Records</h1>
<p>Let&rsquo;s start with the definition of our store. For the purpose I prefer to use Immutable <a href="https://facebook.github.io/immutable-js/docs/#/Record">records</a> because of two main reasons:</p>
<ul>
<li>Immutable stores make the mutation more explicit and well organized.</li>
<li>Records allow convenient property access.</li>
</ul>
<p>Now let&rsquo;s suppose we have the domain object <code>VirtualMachine</code>. We can define a well-typed record using the following definition:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">IVirtualMachine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">state</span>: <span class="kt">VMState</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">connection</span>: <span class="kt">Connection</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">screenshot</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">virtualMachine</span> <span class="o">=</span> <span class="nx">RecordFactory</span><span class="p">&lt;</span><span class="nt">IVirtualMachine</span><span class="p">&gt;({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">state</span>: <span class="kt">VMState.Pending</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">connection</span>: <span class="kt">new</span> <span class="nx">Connection</span><span class="p">({}),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">screenshot</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">VirtualMachine</span> <span class="kr">extends</span> <span class="nx">virtualMachine</span> <span class="kr">implements</span> <span class="nx">IVirtualMachine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">state</span>: <span class="kt">VMState</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">connection</span>: <span class="kt">Connection</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">screenshot</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="nx">config</span>: <span class="kt">Partial</span><span class="p">&lt;</span><span class="nt">IVirtualMachine</span><span class="p">&gt;)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">super</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Notice a few things:</p>
<ul>
<li>We define the interface <code>IVirtualMachine</code>.</li>
<li>We define a <code>virtualMachine</code> record invoking <code>RecordFactory</code> with its type parameter set to <code>IVirtualMachine</code>.</li>
<li>We define a class called <code>VirtualMachine</code> which extends the record and accepts a single property of type <code>Partial&lt;IVirtualMachine&gt;</code> in its constructor.</li>
</ul>
<p>Notice that we export <code>IVirtualMachine</code> and <code>VirtualMachine</code> but keep the <code>virtualMachine</code> record encapsulated inside the current module.</p>
<p>This way we can already instantiate a new <code>VirtualMachine</code> object and configure it using an object literal:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VirtualMachine</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;123&#39;</span><span class="p">,</span> <span class="nx">state</span>: <span class="kt">VMState.Running</span> <span class="p">});</span>
</span></span></code></pre></div><p>Since the <code>config</code> parameter of the constructor is of type <code>Partial&lt;IVirtualMachine&gt;</code> we do not have to set all the properties of the <code>IVirtualMachine</code> interface. Of course, the drawback of this approach is that by mistake we can skip a configuration property and get the default value instead, which might not be the intended behavior. In this specific case, I prefer convenience over security.</p>
<p>In order to get a better idea of why the definition above is safer than a regular record, let&rsquo;s take a look at the <code>RecordFactory</code> function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">Constructable</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="p">(...</span><span class="nx">args</span>: <span class="kt">any</span><span class="p">[])</span><span class="o">:</span> <span class="nx">T</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">StaticallyTypedRecord</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="kr">extends</span> <span class="nx">Constructable</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">get</span><span class="p">&lt;</span><span class="nt">K</span> <span class="na">extends</span> <span class="na">keyof</span> <span class="na">T</span><span class="p">&gt;(</span><span class="nx">key</span>: <span class="kt">K</span><span class="p">)</span><span class="o">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="kr">set</span><span class="p">&lt;</span><span class="nt">K</span> <span class="na">extends</span> <span class="na">keyof</span> <span class="na">T</span><span class="err">,</span> <span class="na">V</span> <span class="na">extends</span> <span class="na">T</span><span class="err">[</span><span class="na">K</span><span class="err">]</span><span class="p">&gt;(</span><span class="nx">key</span>: <span class="kt">K</span><span class="p">,</span> <span class="nx">value</span>: <span class="kt">V</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">withMutations</span><span class="p">(</span><span class="nx">cb</span><span class="o">:</span> <span class="p">(</span><span class="nx">r</span>: <span class="kt">StaticallyTypedRecord</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;)</span> <span class="o">=&gt;</span> <span class="nx">StaticallyTypedRecord</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setIn</span><span class="p">&lt;</span><span class="nt">K1</span> <span class="na">extends</span> <span class="na">keyof</span> <span class="na">T</span><span class="err">,</span> <span class="na">V</span> <span class="na">extends</span> <span class="na">T</span><span class="err">[</span><span class="na">K1</span><span class="err">]</span><span class="p">&gt;(</span><span class="nx">keys</span><span class="o">:</span> <span class="p">[</span><span class="nx">K1</span><span class="p">],</span> <span class="nx">val</span>: <span class="kt">V</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setIn</span><span class="p">&lt;</span><span class="nt">K1</span> <span class="na">extends</span> <span class="na">keyof</span> <span class="na">T</span><span class="err">,</span> <span class="na">K2</span> <span class="na">extends</span> <span class="na">keyof</span> <span class="na">T</span><span class="err">[</span><span class="na">K1</span><span class="err">],</span> <span class="na">V</span> <span class="na">extends</span> <span class="na">T</span><span class="err">[</span><span class="na">K1</span><span class="err">][</span><span class="na">K2</span><span class="err">]</span><span class="p">&gt;(</span><span class="nx">keys</span><span class="o">:</span> <span class="p">[</span><span class="nx">K1</span><span class="p">,</span> <span class="nx">K2</span><span class="p">],</span> <span class="nx">val</span>: <span class="kt">V</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setIn</span><span class="p">&lt;</span><span class="nt">K1</span> <span class="na">extends</span> <span class="na">keyof</span> <span class="na">T</span><span class="err">,</span> <span class="na">K2</span> <span class="na">extends</span> <span class="na">keyof</span> <span class="na">T</span><span class="err">[</span><span class="na">K1</span><span class="err">],</span> <span class="na">K3</span> <span class="na">extends</span> <span class="na">keyof</span> <span class="na">T</span><span class="err">[</span><span class="na">K1</span><span class="err">][</span><span class="na">K2</span><span class="err">],</span> <span class="na">V</span> <span class="na">extends</span> <span class="na">T</span><span class="err">[</span><span class="na">K1</span><span class="err">][</span><span class="na">K2</span><span class="err">][</span><span class="na">K3</span><span class="err">]</span><span class="p">&gt;(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">keys</span><span class="o">:</span> <span class="p">[</span><span class="nx">K1</span><span class="p">,</span> <span class="nx">K2</span><span class="p">,</span> <span class="nx">K3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nx">val</span>: <span class="kt">V</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">toJS</span><span class="p">()</span><span class="o">:</span> <span class="nx">T</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">RecordFactory</span> <span class="o">=</span> <span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">seed</span>: <span class="kt">T</span><span class="p">)</span><span class="o">:</span> <span class="nx">StaticallyTypedRecord</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span><span class="nx">Record</span><span class="p">(</span><span class="nx">seed</span><span class="p">)</span> <span class="kr">as</span> <span class="kt">any</span><span class="p">)</span> <span class="kr">as</span> <span class="nx">StaticallyTypedRecord</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Here we have three definitions:</p>
<ul>
<li><code>Constructable&lt;T&gt;</code> is a generic interface which defines a type for a family of objects which can be instantiated with the operator <code>new</code>.</li>
<li><code>StaticallyTypedRecord&lt;T&gt;</code> is another generic interface which extends the <code>Constructable&lt;T&gt;</code> interface and declares a bunch of methods. These are all methods in the prototype of the <code>Immutable.Record</code> abstraction.</li>
<li><code>RecordFactory</code> is a generic function which accepts an object called <code>seed</code> of type <code>T</code>, passes it to <code>Immutable.Record(seed)</code> and ascribes the result to the type <code>StaticallyTypedRecord&lt;T&gt;</code>.</li>
</ul>
<p>What&rsquo;s the win here?</p>
<p>Let&rsquo;s suppose we have our VM:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VirtualMachine</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;123&#39;</span><span class="p">,</span> <span class="nx">screenshot</span><span class="o">:</span> <span class="s1">&#39;...&#39;</span> <span class="p">});</span>
</span></span></code></pre></div><p>Now if we want to access the VM properties we can:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="nx">vm</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">vm</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// [ts] Argument of type &#39;&#34;ID&#34;&#39; is not assignable to
</span></span></span><span class="line"><span class="cl"><span class="c1">// parameter of type &#39;&#34;id&#34; | &#34;state&#34; | &#34;connection&#34; | &#34;screenshot&#34; | &#34;templateId&#34;&#39;.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">vm</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// [ts] Property &#39;ID&#39; does not exist on type &#39;VirtualMachine&#39;. Did you mean &#39;id&#39;?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">vm</span><span class="p">.</span><span class="nx">ID</span><span class="p">;</span>
</span></span></code></pre></div><p>Notice how we got a compile-time error when we tried to access the <code>id</code> property with <code>vm.get('ID')</code> since such key doesn&rsquo;t exist in the record.</p>
<p>We are also going to get compile-time errors when trying to set a missing property:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// [ts] Argument of type &#39;&#34;scrnshot&#34;&#39; is not assignable to
</span></span></span><span class="line"><span class="cl"><span class="c1">// parameter of type &#39;&#34;id&#34; | &#34;state&#34; | &#34;connection&#34; | &#34;screenshot&#34; | &#34;templateId&#34;&#39;.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">vm</span><span class="p">.</span><span class="kr">set</span><span class="p">(</span><span class="s1">&#39;scrnshot&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>This way we&rsquo;re able to catch mistakes caused by a misspelling of a property name much sooner - at compile-time!</p>
<p>Even further, now let&rsquo;s suppose the <code>Connection</code> abstraction has an <code>ipAddress</code> field of type <code>string</code>. If we want to set it using the <code>setIn</code> method of the <code>VirtualMachine</code> record and we misspell it we&rsquo;re going to get a compile-time error again!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// [ts]
</span></span></span><span class="line"><span class="cl"><span class="c1">// Argument of type &#39;[&#34;connection&#34;, &#34;ipaddress&#34;]&#39; is not assignable to parameter of type &#39;[&#34;connection&#34;, &#34;id&#34; | &#34;connectionId&#34; | &#34;type&#34; | &#34;get&#34; | &#34;set&#34; | &#34;withMu...&#39;.
</span></span></span><span class="line"><span class="cl"><span class="c1">//   Types of property &#39;1&#39; are incompatible.
</span></span></span><span class="line"><span class="cl"><span class="c1">//     Type &#39;&#34;ipaddress&#34;&#39; is not assignable to type &#39;&#34;id&#34; | &#34;connectionId&#34; | &#34;ipAddress&#34; | &#34;get&#34; | &#34;set&#34; | &#34;withMutations&#34; | &#34;set...&#39;.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">vm</span><span class="p">.</span><span class="nx">setIn</span><span class="p">([</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="s1">&#39;ipaddress&#39;</span><span class="p">],</span> <span class="s1">&#39;192.168.0.102&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>Notice that currently, we support no more than three levels of nesting with <code>setIn</code>, this is due to the explicit definition above. A random level of nesting will be possible once the <a href="https://github.com/Microsoft/TypeScript/issues/5453">variadic types</a> proposal gets introduced into TypeScript.</p>
<h1 id="action-creators">Action Creators</h1>
<p>Alright, we now have a solid foundation for our store. Now, we can define the actions in the application. First, we can define an enum which contains all the action types:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">enum</span> <span class="nx">ActionType</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">AddVirtualMachine</span> <span class="o">=</span> <span class="s1">&#39;AddVM&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">RemoveVirtualMachine</span> <span class="o">=</span> <span class="s1">&#39;RemoveVM&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>As next step, we can define an interface for each action:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">AddVirtualMachine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">type</span><span class="o">:</span> <span class="nx">ActionType</span><span class="p">.</span><span class="nx">AddVirtualMachine</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">vm</span>: <span class="kt">VirtualMachine</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">interface</span> <span class="nx">RemoveVirtualMachine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">type</span><span class="o">:</span> <span class="nx">ActionType</span><span class="p">.</span><span class="nx">RemoveVirtualMachine</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span>: <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">Action</span> <span class="o">=</span> <span class="nx">AddVirtualMachine</span> <span class="o">|</span> <span class="nx">RemoveVirtualMachine</span><span class="p">;</span>
</span></span></code></pre></div><p>Notice that in the end we also define the type <code>Action</code> as the intersection between the <code>AddVirtualMachine</code> and <code>RemoveVirtualMachine</code>. This allows us to have very convenient support from the type checker in our reducers:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">virtualMachinesReducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">action</span>: <span class="kt">Action</span><span class="p">,</span> <span class="nx">state</span>: <span class="kt">List</span><span class="p">&lt;</span><span class="nt">VirtualMachine</span><span class="p">&gt;</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">switch</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="kr">type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nx">ActionType.AddVirtualMachine</span>:
</span></span><span class="line"><span class="cl">    <span class="kt">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">vm</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nx">ActionType.RemoveVirtualMachine</span>:
</span></span><span class="line"><span class="cl">    <span class="kt">return</span> <span class="nx">state</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">((</span><span class="nx">v</span>: <span class="kt">VirtualMachine</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>In this case, the type checker will know exactly what the type of the <code>action</code> argument will be in any of the branches of the <code>switch</code> statement, so we will get a great type checking support and auto-completion.</p>
<h2 id="interface-vs-factory">Interface vs Factory</h2>
<p>A typical pattern in redux is to use factories for creating the action objects. Another typical pattern in the Angular community (more specifically, this part of it using <code>ngrx</code>) is to use classes, for example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">AddVirtualMachine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">readonly</span> <span class="kr">type</span> <span class="o">=</span> <span class="nx">ActionType</span><span class="p">.</span><span class="nx">AddVirtualMachine</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">public</span> <span class="nx">vm</span>: <span class="kt">VirtualMachine</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">RemoveVirtualMachine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">readonly</span> <span class="kr">type</span> <span class="o">=</span> <span class="nx">ActionType</span><span class="p">.</span><span class="nx">RemoveVirtualMachine</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">constructor</span><span class="p">(</span><span class="kr">public</span> <span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>When using classes we get few benefits:</p>
<ul>
<li>Read-only action type because of the <code>readonly</code> modified in the property declaration.</li>
<li>Convenient static typing when passing the arguments to the constructor.</li>
</ul>
<p>Let&rsquo;s compare two syntaxes for dispatching actions - one using classes and another just object literals:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="nx">dispatch</span><span class="p">(</span><span class="k">new</span> <span class="nx">RemoveVirtualMachine</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nx">dispatch</span><span class="p">({</span> <span class="kr">type</span><span class="o">:</span> <span class="nx">ActionType</span><span class="p">.</span><span class="nx">RemoveVirtualMachine</span><span class="p">,</span> <span class="nx">id</span>: <span class="kt">vm.id</span> <span class="p">})</span>
</span></span></code></pre></div><p>We can clearly see that the second option is a bit longer and also couples the component with the action type. On the other hand, new need to introduce an additional middleware in redux because by default it accepts only &ldquo;plain&rdquo; objects:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">isPlainObject</span> <span class="o">=</span> <span class="kr">require</span><span class="p">(</span><span class="s1">&#39;lodash.isplainobject&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Allows us have the privilege to create actions
</span></span></span><span class="line"><span class="cl"><span class="c1">// with classes instead of action creators.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">const</span> <span class="nx">plainObjectMiddleware</span> <span class="o">=</span> <span class="nx">store</span> <span class="o">=&gt;</span> <span class="nx">next</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">a</span>: <span class="kt">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isPlainObject</span><span class="p">(</span><span class="nx">a</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">result</span>: <span class="kt">any</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// We don&#39;t need hasOwnProperty and we know what we are doing.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// tslint:disable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">result</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// tslint:enable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">a</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><h1 id="improved-middleware-declaration">Improved Middleware Declaration</h1>
<p>By default the TypeScript&rsquo;s type definitions for redux come with the following middleware interface:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">Middleware</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">S</span><span class="p">&gt;(</span><span class="nx">api</span>: <span class="kt">MiddlewareAPI</span><span class="p">&lt;</span><span class="nt">S</span><span class="p">&gt;)</span><span class="o">:</span> <span class="p">(</span><span class="nx">next</span>: <span class="kt">Dispatch</span><span class="p">&lt;</span><span class="nt">S</span><span class="p">&gt;)</span> <span class="o">=&gt;</span> <span class="nx">Dispatch</span><span class="p">&lt;</span><span class="nt">S</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>This way when we want to declare a middleware, let&rsquo;s say:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Middleware</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;redux&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">sampleMiddleware</span> <span class="o">=</span> <span class="p">()</span><span class="o">:</span> <span class="nx">Middleware</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">({</span> <span class="nx">getState</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">next</span> <span class="o">=&gt;</span> <span class="nx">action</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">getState</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>This snippet has few problems:</p>
<ul>
<li><code>getState</code> will have type <code>S</code> which in this case is completely meaningless to us.</li>
<li><code>next</code> has type <code>Dispatch&lt;S&gt;</code>, completely meaningless as well.</li>
<li><code>action</code> has type <code>any</code>, which doesn&rsquo;t bring any extra semantics.</li>
</ul>
<p>To have a well-typed middleware we can apply the following definition:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">sampleMiddleware</span> <span class="o">=</span> <span class="p">()</span><span class="o">:</span> <span class="nx">Middleware</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">({</span> <span class="nx">getState</span> <span class="p">}</span><span class="o">:</span> <span class="nx">MiddlewareAPI</span><span class="p">&lt;</span><span class="nt">IStore</span><span class="p">&gt;)</span> <span class="o">=&gt;</span> <span class="nx">next</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nt">A</span> <span class="na">extends</span> <span class="na">Action</span><span class="p">&gt;(</span><span class="nx">action</span>: <span class="kt">A</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">getState</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>This brings several improvements:</p>
<ul>
<li><code>getState</code> is well-typed because of <code>MiddlewareAPI&lt;IStore&gt;</code> type.</li>
<li><code>next</code> has now type <code>Dispatch&lt;IStore&gt;</code>, thanks to the <code>MiddlewareAPI&lt;IStore&gt;</code> annotation.</li>
<li><code>action</code> now brings some extra semantics, for instance, we can access its <code>type</code> property and in case of a conditional statement, we can use the provided by TypeScript control flow type inference.</li>
</ul>
<p><strong>Note</strong> that, depending on the version of the redux type definitions you use, you may need to take advantage of the open interfaces of TypeScript and improve the <code>Middleware</code> declaration:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">MiddlewareAPI</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;redux&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">declare</span> <span class="nx">module</span> <span class="s1">&#39;redux&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">export</span> <span class="kr">interface</span> <span class="nx">Middleware</span><span class="p">&lt;</span><span class="nt">T</span> <span class="err">=</span> <span class="na">any</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">U</span><span class="p">&gt;(</span><span class="nx">api</span>: <span class="kt">MiddlewareAPI</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;)</span><span class="o">:</span> <span class="p">(</span><span class="nx">next</span>: <span class="kt">Dispatch</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;)</span> <span class="o">=&gt;</span> <span class="nx">Dispatch</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Otherwise, you may get the error:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">ts</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">Type</span> <span class="s1">&#39;&lt;S&gt;({ getState }: MiddlewareAPI&lt;IStore&gt;) =&gt; (next: Dispatch&lt;S&gt;) =&gt; &lt;A extends Action&gt;(action: A) ...&#39;</span> <span class="k">is</span> <span class="nx">not</span> <span class="nx">assignable</span> <span class="nx">to</span> <span class="kr">type</span> <span class="s1">&#39;Middleware&#39;</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Types</span> <span class="k">of</span> <span class="nx">parameters</span> <span class="s1">&#39;__0&#39;</span> <span class="nx">and</span> <span class="s1">&#39;api&#39;</span> <span class="nx">are</span> <span class="nx">incompatible</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Type</span> <span class="s1">&#39;MiddlewareAPI&lt;S&gt;&#39;</span> <span class="k">is</span> <span class="nx">not</span> <span class="nx">assignable</span> <span class="nx">to</span> <span class="kr">type</span> <span class="s1">&#39;MiddlewareAPI&lt;IStore&gt;&#39;</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">      <span class="nx">Type</span> <span class="s1">&#39;S&#39;</span> <span class="k">is</span> <span class="nx">not</span> <span class="nx">assignable</span> <span class="nx">to</span> <span class="kr">type</span> <span class="s1">&#39;IStore&#39;</span><span class="p">.</span>
</span></span></code></pre></div><h1 id="conclusion">Conclusion</h1>
<p>Redux provides a lovely architectural pattern which allows us to isolate the side-effects and keep most of our codebase pure. This way, the state management of our application gets much more predictable.</p>
<p>On top of this, using a statically typed language which fails early when the compiler finds a defect in our program brings significant improvements in our development process.</p>
<p>Combining Redux and TypeScript is a great middle ground between purity and practicality.</p>

                </section>
            </article>

            

            
                <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'mgechev';

     
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            

            

            <footer id="footer">
    <div class="by-author">with <i class="fa fa-heart" aria-hidden="true"></i> by Minko Gechev</div>
    <p class="small">
         © Copyright 2023  
    </p>
</footer>
        </section>

        <script src="https://blog.mgechev.com/js/main.js"></script>




  
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-18060688-3', 'auto');
	
	ga('send', 'pageview');
}
</script>


<script async src="//twemoji.maxcdn.com/2/twemoji.min.js?2.3.0"></script>
<script>
  window.addEventListener('load', function () {
    twemoji.parse(document.body, { size: 72 });
  });
</script>



    </body>
</html>
