    <!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		
		<meta name="generator" content="Hugo 0.91.2" />
		<title>Aspect-Oriented Programming with AngularJS &middot; Minko Gechev&#39;s blog</title>
		<link rel="shortcut icon" href="https://blog.mgechev.com/images/favicon.ico">
		<link rel="stylesheet" href="https://blog.mgechev.com/css/highlight.css">
		<link rel="stylesheet" href="https://blog.mgechev.com/css/style.css">
		

		
		<link rel="stylesheet" href="https://blog.mgechev.com/css/font-awesome.min.css">
		

		
		<link href="https://blog.mgechev.com/feed.xml" rel="alternate" type="application/rss+xml" title="Minko Gechev&#39;s blog">
		
		
		<link rel="amphtml" href="https://blog.mgechev.com/amp/2013/08/07/aspect-oriented-programming-with-javascript-angularjs/">
		

		<meta property="og:title" content="Aspect-Oriented Programming with AngularJS" />
		<meta property="og:description" content="In the following blog post I’ll write few words about what is Aspect-Oriented Programming, why I think it will be useful in AngularJS and I’m also going to give you a short tutorial for using a simple AOP framework I’ve developed.
First things first. What is AOP? As we all know OOP is awesome! It gives us many tools for making our development process simpler. Its core principles are Abstraction, Encapsulation, Inheritance and Polymorphism." />
		<meta property="og:type" content="article" />
		<meta property="og:url" content="https://blog.mgechev.com/2013/08/07/aspect-oriented-programming-with-javascript-angularjs/" />
		
		<meta property="og:image" content="https://blog.mgechev.com/images/myself.jpg"/>
		<meta property="og:image:secure_url" content="https://blog.mgechev.com/images/myself.jpg"/>
		
	</head>

    <body>
       <nav class="main-nav">
  
  <div class="link-wrapper">
	
	
		<a href='https://blog.mgechev.com/'> <span class="arrow">←</span>Home</a>
	
	<a href='https://blog.mgechev.com/post'>Posts</a>
	<a href='https://blog.mgechev.com/about'>About</a>
	<a href='https://blog.mgechev.com/talks'>Speaking</a>
  </div>

	

	
  
	
</nav>
<a href="https://github.com/mgechev" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="z-index: 100000; fill:#70B7FD; color:#fff; position: fixed; top: 20px; border: 0; left: 20px; transform: scale(-1.5, 1.5);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>


        <section id="wrapper">
            <article class="post">
                <header>
                    <h1>
                        Aspect-Oriented Programming with AngularJS
                    </h1>
                    <h2 class="headline">
                    <a href="https://github.com/mgechev/blog.mgechev.com/tree/master/content/post/2013-08-07-aspect-oriented-programming-with-javascript-angularjs.md">
                        <i class="fa fa-pencil-square-o"></i> Edit
                    </a>
                    · Aug 7, 2013
                    · 7 minutes read
                    · <a href="https://twitter.com/mgechev?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="true">Follow @mgechev</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                      <span class="tags">
                      
                      
                          
                              <a href="https://blog.mgechev.com/tags/angularjs">AngularJS</a>
                          
                              <a href="https://blog.mgechev.com/tags/aop">aop</a>
                          
                              <a href="https://blog.mgechev.com/tags/aspect-oriented-programming">aspect-oriented programming</a>
                          
                              <a href="https://blog.mgechev.com/tags/computer-science">Computer science</a>
                          
                              <a href="https://blog.mgechev.com/tags/development">Development</a>
                          
                              <a href="https://blog.mgechev.com/tags/internet">Internet</a>
                          
                              <a href="https://blog.mgechev.com/tags/javascript">JavaScript</a>
                          
                              <a href="https://blog.mgechev.com/tags/programming">Programming</a>
                          
                              <a href="https://blog.mgechev.com/tags/programming-languages">programming languages</a>
                          
                              <a href="https://blog.mgechev.com/tags/projects">Projects</a>
                          
                      
                      
                      </span>
                    </h2>
                </header>
                
                <section id="post-body">
                    <p>In the following blog post I’ll write few words about what is Aspect-Oriented Programming, why I think it will be useful in AngularJS and I’m also going to give you a short tutorial for using a <a title="GitHub" href="https://github.com/mgechev/angular-aop" target="_blank">simple AOP framework I’ve developed</a>.</p>
<p>First things first. What is AOP? As we all know OOP is awesome! It gives us many tools for making our development process simpler. Its core principles are Abstraction, Encapsulation, Inheritance and Polymorphism.</p>
<p>Abstraction helps us build complex applications without thinking for all details. We just “find” the correct level of abstraction for the current phase of development and use it until it’s useful for us. For example when we develop complex OS the first (or one of the first) levels of abstraction, I guess, will include creating a facade for all different hardware platforms but after that the hardware differences wont matter for us and we’ll use higher level interface.</p>
<p>Encapsulation and abstraction are complementary concepts. Encapsulation gives us more details about the implementation behind the visible interface which is our abstraction of the given class or object.</p>
<p>Inheritance gives us code reuse, and polymorphism gives us a common way of handling different instances of different classes in the same hierarchy (and few more things but let’s stop here).</p>
<p>But what we don’t have?</p>
<p>Let’s define the concept of cross-cutting concern:</p>
<blockquote cite="https://en.wikipedia.org/wiki/Cross-cutting_concern">
  <p>
    In computer science, cross-cutting concerns are aspects of a program that affect other concerns. These concerns often cannot be cleanly decomposed from the rest of the system in both the design and implementation, and can result in either scattering (code duplication), tangling (significant dependencies between systems), or both.
  </p>
</blockquote>
<p>The most common examples for cross-cutting concerns are logging, authentication and transactions.<br>
Let’s focus in logging. We may need to log different informations when different methods are called. That means we should have things like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;log before&#39;</span><span class="p">);</span>
  <span class="c1">//body
</span><span class="c1"></span>  <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;log after&#39;</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>
<p>If we change the interface of our logger we should change it everywhere, this may affect hundreds of different files.<br>
The situation can become even more complex if we add authentication:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">Authotization</span><span class="p">.</span><span class="nx">isAuthorized</span><span class="p">();</span>
    <span class="c1">//body
</span><span class="c1"></span>  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//handle the error
</span><span class="c1"></span>  <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>It may look ok for one or few functions/methods but if their count increase you can shoot yourself in the foot with so many duplicates.<br>
OOP don’t gives us tools for handling such problems. It may suggest to create few helper classes and just copy and paste pieces of code from one place to another.</p>
<p>In AOP we have few more concepts: joint-point – this is place where something happen. For example call of procedure, return of result by a function, throw of exception, call of constructor, etc.</p>
<p>We have also pointcuts. Pointscuts help us describe one or more joint-points. The last concept I’ll define are the advices. They are pieces of code which will be executed in given moment (when joint-points is encountered during the program runs).</p>
<p>To show you how AOP can be useful in AngularJS let me introduce you <a title="GitHub" href="https://github.com/mgechev/angular-aop" target="_blank">AngularAOP</a>.</p>
<h2 id="angularaop">AngularAOP</h2>
<p>You can define the cross-cutting concerns in separate services. For example here is a definition of logging service which logs the method calls and thrown exceptions:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">DemoApp</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;Logger&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">exception</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;%cException: &#39;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">.</span><span class="nx">exception</span><span class="p">.</span><span class="nx">message</span> <span class="o">+</span> <span class="s1">&#39;. &#39;</span>
                <span class="o">+</span> <span class="nx">args</span><span class="p">.</span><span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39; called before proper authorization.&#39;</span><span class="p">,</span>
                <span class="s1">&#39;color: red; text-weight: bold; font-size: 1.2em;&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">throwData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">exception</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39; and threw: &#39;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">.</span><span class="nx">exception</span><span class="p">.</span><span class="nx">message</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Method: &#39;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">.</span><span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;, Pointcut: &#39;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">.</span><span class="nx">when</span> <span class="o">+</span> <span class="s1">&#39;, with arguments: &#39;</span> <span class="o">+</span>
                    <span class="nx">angular</span><span class="p">.</span><span class="nx">toJson</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">args</span><span class="p">)</span> <span class="o">+</span> <span class="nx">throwData</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">});</span></code></pre></div>
<p>The definition of that service doesn’t differ from the usual service definition.<br>
Here is definition of one more service which can cause problems with the code maintenance because it is a cross-cutting concern:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">DemoApp</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">User</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">User</span><span class="p">.</span><span class="nx">getUsername</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">&#39;foo&#39;</span> <span class="o">&amp;&amp;</span>
            <span class="nx">User</span><span class="p">.</span><span class="nx">getPassword</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Not authorized&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">});</span></code></pre></div>
<p>The given service just checks whether user’s user name and password are equal respectively to “foo” and “bar”, if they are not equal to these values the service throws an Error(‘Not authorized’).</p>
<p>We may want to apply authorization for reading news:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">DemoApp</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;ArticlesCollection&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$q</span><span class="p">,</span> <span class="nx">$timeout</span><span class="p">,</span> <span class="nx">execute</span><span class="p">,</span> <span class="nx">Logger</span><span class="p">,</span> <span class="nx">Authorization</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">sampleArticles</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Title 1&#39;</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Content 1&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Title 2&#39;</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Content 2&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Title 3&#39;</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Content 3&#39;</span> <span class="p">}</span>
        <span class="p">],</span>
        <span class="nx">privateArticles</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Title 4&#39;</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Content 4&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Title 5&#39;</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Content 5&#39;</span> <span class="p">}</span>
        <span class="p">],</span>
        <span class="nx">api</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">loadArticles</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
                <span class="nx">$timeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">sampleArticles</span><span class="p">);</span>
                <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
            <span class="p">},</span>
            <span class="nx">getArticleById</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sampleArticles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">sampleArticles</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span>  <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">sampleArticles</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
            <span class="p">},</span>
            <span class="nx">getPrivateArticles</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">privateArticles</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>
    <span class="k">return</span> <span class="nx">api</span><span class="p">;</span>
<span class="p">});</span></code></pre></div>
<p>This is simple service which contains two kinds of articles (simple object literals): sampleArticles and privateArticles. The api object is the actual service public interface.</p>
<p>We may want to apply authorization to the private articles, before the getPrivateArticles method return its result. The usual way to do it is:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">getPrivateArticles</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Authorization</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">privateArticles</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>
<p>We may also want to apply authorization to the getArticleById method, so:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">getArticleById</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Authorization</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sampleArticles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">sampleArticles</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span>  <span class="p">{</span>
            <span class="k">return</span> <span class="nx">sampleArticles</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>
<p>We have two duplicate lines of code. At this moment it’s not a big deal but we may want to add logging and see special error message in the console when Error is thrown:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">//...
</span><span class="c1"></span><span class="nx">getPrivateArticles</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">Authorization</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">privateArticles</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;%cException: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span> <span class="o">+</span> <span class="s1">&#39;. getPrivateArticles called before proper authorization.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color: red; text-weight: bold; font-size: 1.2em;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="nx">getArticleById</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">Authorization</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sampleArticles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">sampleArticles</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span>  <span class="p">{</span>
                <span class="k">return</span> <span class="nx">sampleArticles</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;%cException: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span> <span class="o">+</span> <span class="s1">&#39;. getArticleById called before proper authorization.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color: red; text-weight: bold; font-size: 1.2em;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//...
</span></code></pre></div>
<p>Now we have a lot of duplicates and if we want to change something in the code which authorises the user and logs the error we should change it in both places. We may have service with large interface which requires logging and authorisation (or something else) in all of its methods or big part of them. In this case we need something more powerful and the Aspect-Oriented Programming gives us the tools for that.</p>
<p>We can achieve the same effect as in the code above just by applying Authorization and Logger service to the api object:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="k">return</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">Logger</span><span class="p">).</span><span class="nx">onThrowOf</span><span class="p">(</span><span class="nx">execute</span><span class="p">(</span><span class="nx">Authorization</span><span class="p">).</span><span class="nx">before</span><span class="p">(</span><span class="nx">api</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">methodPattern</span><span class="o">:</span> <span class="sr">/Special|getArticleById/</span>
<span class="p">}));</span></code></pre></div>
<p>This code will invoke the Authorization service before executing the methods which match the pattern: /Special|getArticleById/ when an Error is thrown the Logger will log it with detailed information. Notice that onThrowOf, before and all the methods listed below return object with the same methods so chaining is possible. We can also match the methods not only by their names but also by their arguments:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="k">return</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">Logger</span><span class="p">).</span><span class="nx">onThrowOf</span><span class="p">(</span><span class="nx">execute</span><span class="p">(</span><span class="nx">Authorization</span><span class="p">).</span><span class="nx">before</span><span class="p">(</span><span class="nx">api</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">methodPattern</span><span class="o">:</span> <span class="sr">/Special|getArticleById/</span><span class="p">,</span>
    <span class="nx">argsPatterns</span><span class="o">:</span> <span class="p">[</span><span class="sr">/^user$, /</span><span class="o">^</span><span class="p">[</span><span class="nx">Ii</span><span class="p">]</span><span class="nx">d</span><span class="p">(</span><span class="nx">_num</span><span class="p">)</span><span class="o">?</span><span class="nx">$</span><span class="o">/</span><span class="p">]</span>
<span class="p">}));</span></code></pre></div>
<p>Now the aspects will be applied only to the methods which match both the methodPattern and argsPatterns rules.</p>
<p>Currently execute supports the following pointcuts:</p>
<ul>
<li>before – executes given service before the matched methods are invoked.</li>
<li>after – executes given service after the matched methods are invoked.</li>
<li>around – executes given service before and after the matched methods are invoked.</li>
<li>onThrowOf – executes when an Error is thrown by method from the given set of matched methods.</li>
<li>onResolveOf – executes after promise returned by a method from the given set of matched methods is resolved but before the resolve callback is invoked.</li>
<li>afterResolveOf – executes after promise returned by a method from the given set of matched methods is resolved but after the resolve callback is invoked.</li>
<li>onRejectOf – executes after promise returned by a method from the given set of matched methods is rejected.</li>
</ul>
<p>Aspects can be applied not only to objects but also to functions:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">DemoApp</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;ArticlesCollection&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$q</span><span class="p">,</span> <span class="nx">$timeout</span><span class="p">,</span> <span class="nx">execute</span><span class="p">,</span> <span class="nx">Logger</span><span class="p">,</span> <span class="nx">Authorization</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">Logger</span><span class="p">).</span><span class="nx">before</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">//body
</span><span class="c1"></span>    <span class="p">});</span>
<span class="p">});</span></code></pre></div>
<p><a title="GitHub" href="https://github.com/mgechev/angular-aop" target="_blank">AngularAOP</a> can be found at: <a title="GitHub" href="https://github.com/mgechev/angular-aop" target="_blank">GitHub</a></p>

                </section>
            </article>

            

            
                <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'mgechev';

     
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            

            

            <footer id="footer">
    <div class="by-author">with <i class="fa fa-heart" aria-hidden="true"></i> by Minko Gechev</div>
    <p class="small">
         © Copyright 2021  
    </p>
</footer>
        </section>

        <script src="https://blog.mgechev.com/js/main.js"></script>




  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-18060688-3', 'auto');
	
	ga('send', 'pageview');
}
</script>


<script async src="//twemoji.maxcdn.com/2/twemoji.min.js?2.3.0"></script>
<script>
  window.addEventListener('load', function () {
    twemoji.parse(document.body, { size: 72 });
  });
</script>



    </body>
</html>
